<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC 교사 상담 도구</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .step-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .step-card.active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
        }
        
        .emotion-btn {
            transition: all 0.2s ease;
        }
        
        .emotion-btn:hover {
            transform: translateY(-2px);
        }
        
        .emotion-btn.selected {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .checklist-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .checklist-item:hover {
            background-color: #f1f5f9;
        }
        
        .checklist-item.checked {
            background-color: #dcfce7;
            border-color: #16a34a;
        }
        
        .progress-bar {
            transition: width 0.3s ease;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .situation-card {
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            border: 2px solid #e5e7eb;
        }
        
        .situation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .situation-card.selected {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        .message-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">🌟 ABC 교사 상담 도구</h1>
            <p class="text-lg text-gray-600">학생이 선생님의 고민을 듣고 조언하며 함께 해결책을 찾는 또래 상담 서비스</p>
        </div>

        <!-- 진행 상태 바 -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-medium text-gray-700">진행 상황</span>
                <span class="text-sm font-medium text-gray-700" id="progressText">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-blue-600 h-3 rounded-full progress-bar" style="width: 0%" id="progressBar"></div>
            </div>
        </div>

        <!-- 단계 1: 기본 정보 입력 -->
        <div class="step-card active border-2 rounded-lg p-6 mb-6" id="step1">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">1️⃣ 기본 정보를 입력해주세요</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👦 상담하는 학생 이름</label>
                    <input type="text" id="studentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="김민수">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👩‍🏫 상담받는 선생님 이름</label>
                    <input type="text" id="teacherName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="이영희 선생님">
                </div>
            </div>
            <div class="mt-6 text-right">
                <button onclick="nextStep(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 2: 고민 선택 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step2">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">2️⃣ 선생님의 고민을 선택해주세요</h2>
            
            <!-- 카테고리 선택 -->
            <div id="categorySelection">
                <h3 class="text-lg font-medium mb-3 text-gray-700">먼저 고민 분야를 선택해주세요</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="worryCategories">
                    <!-- 고민 카테고리들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 구체적 상황 선택 -->
            <div id="situationSelection" class="hidden">
                <div class="flex items-center mb-4">
                    <button onclick="backToCategories()" class="text-blue-500 hover:text-blue-600 mr-3">← 분야 다시 선택</button>
                    <h3 class="text-lg font-medium text-gray-700" id="selectedCategoryTitle"></h3>
                </div>
                
                <div class="grid gap-3 mb-6" id="situationList">
                    <!-- 구체적 상황들이 여기에 동적으로 추가됩니다 -->
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-gray-800 mb-2">또는 직접 입력하기</h4>
                    <textarea id="customWorry" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="이 분야에서 다른 고민이 있다면 여기에 적어주세요..." oninput="checkCustomWorryInput()"></textarea>
                </div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(2)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(2)" id="step2Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 3: ABC 정리 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step3">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">3️⃣ ABC로 상황을 정리해보아요</h2>
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold text-red-700 mb-2">🅰️ 사실 (Facts)</h3>
                    <p class="text-sm text-gray-600 mb-2">실제로 일어난 일</p>
                    <textarea id="factA" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-700 mb-2">🅱️ 생각 (Beliefs)</h3>
                    <p class="text-sm text-gray-600 mb-2">그때 든 생각이나 믿음</p>
                    <textarea id="beliefB" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-700 mb-2">🅲️ 결과 (Consequences)</h3>
                    <p class="text-sm text-gray-600 mb-2">그래서 나타난 감정이나 행동</p>
                    <textarea id="consequenceC" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3"></textarea>
                </div>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(3)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(3)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 4: 감정 공감 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step4">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">4️⃣ 선생님의 감정에 공감해주세요</h2>
            <p class="text-gray-600 mb-6">선생님이 지금 어떤 기분이실까요? 가장 가까운 감정을 선택해주세요.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6" id="emotionButtons">
                <!-- 감정 버튼들이 여기에 동적으로 추가됩니다 -->
            </div>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 hidden" id="empathyMessage">
                <h3 class="font-medium text-green-700 mb-2">💚 공감 메시지</h3>
                <p id="empathyText" class="text-gray-700"></p>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(4)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(4)" id="step4Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 5: 조언 체크리스트 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step5">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">5️⃣ 학생의 경험으로 조언해주세요</h2>
            <p class="text-gray-600 mb-6">여러분의 경험에서 도움이 될 만한 것들을 선택해주세요.</p>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-700 mb-3">🤔 생각해볼 점</h3>
                    <div id="thinkingChecklist" class="space-y-2">
                        <!-- 생각 체크리스트가 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="font-semibold text-green-700 mb-3">🙋‍♀️ 행동 아이디어</h3>
                    <div id="helpChecklist" class="space-y-2">
                        <!-- 행동 체크리스트가 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 hidden" id="advicePreview">
                <h3 class="font-medium text-blue-700 mb-2">📝 생성된 조언</h3>
                <div id="adviceText" class="text-gray-700"></div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(5)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 6: 격려 메시지 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">6️⃣ 격려 메시지를 전해주세요</h2>
            
            <div class="text-center mb-6">
                <button onclick="drawEncouragementMessage()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-lg font-medium text-lg transition-colors">
                    🎯 격려 메시지 뽑기
                </button>
            </div>

            <div class="message-card rounded-lg p-6 mb-6 hidden" id="encouragementCard">
                <h3 class="font-semibold text-yellow-800 mb-3 text-center">💌 뽑힌 격려 메시지</h3>
                <p id="encouragementText" class="text-gray-800 text-center text-lg font-medium"></p>
            </div>

            <div class="bg-pink-50 border border-pink-200 rounded-lg p-4 mb-6">
                <h3 class="font-medium text-pink-700 mb-2">✏️ 개인적인 메시지 추가</h3>
                <textarea id="personalMessage" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" rows="3" placeholder="선생님께 전하고 싶은 개인적인 응원 메시지를 적어주세요..."></textarea>
            </div>

            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
                <h3 class="font-medium text-indigo-700 mb-3">🤝 실천 약속</h3>
                <div class="grid md:grid-cols-2 gap-2" id="commitmentOptions">
                    <!-- 실천 약속 옵션들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(6)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(6)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">완성하기 🎉</button>
            </div>
        </div>

        <!-- 단계 7: 결과 확인 및 저장 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step7">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">🎉 상담이 완료되었습니다!</h2>
            
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6" id="finalResult">
                <!-- 최종 결과가 여기에 표시됩니다 -->
            </div>

            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <button onclick="saveAsText()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    📄 텍스트로 저장
                </button>
                <button onclick="printResult()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    🖨️ 인쇄하기
                </button>
                <button onclick="resetForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                    🔄 새로 시작하기
                </button>
            </div>
        </div>
    </div>

    <!-- 도움말 버튼 -->
    <button onclick="showHelp()" class="floating-btn bg-indigo-500 hover:bg-indigo-600 text-white p-4 rounded-full shadow-lg transition-colors">
        ❓
    </button>

    <script>
        // 전역 변수
        let currentStep = 1;
        let selectedWorry = null;
        let selectedCategory = null;
        let selectedEmotion = null;
        let selectedAdvice = { thinking: [], help: [] };
        let selectedCommitments = [];

        // 데이터
        const worryCases = {
            "수업 참여": [
                { text: "학생들이 수업 시간에 집중하지 않아요", abc: { a: "수업 중 학생들이 딴짓을 하거나 떠들었다", b: "내 수업이 재미없나보다", c: "속상하고 자신감이 떨어진다" } },
                { text: "질문해도 대답하는 학생이 없어요", abc: { a: "질문을 했는데 아무도 대답하지 않았다", b: "학생들이 이해하지 못했나보다", c: "당황스럽고 걱정된다" } },
                { text: "발표를 시켜도 소극적이에요", abc: { a: "발표 시간에 학생들이 손을 들지 않는다", b: "학생들이 자신감이 없는 것 같다", c: "어떻게 도와줘야 할지 모르겠다" } }
            ],
            "학급 관리": [
                { text: "아이들이 자꾸 싸워요", abc: { a: "휴식시간마다 학생들이 다툰다", b: "내가 관리를 제대로 못하나보다", c: "스트레스받고 피곤하다" } },
                { text: "규칙을 지키지 않는 학생이 있어요", abc: { a: "같은 학생이 계속 규칙을 어긴다", b: "이 학생을 어떻게 지도해야 할까", c: "답답하고 고민된다" } },
                { text: "학급 분위기가 어수선해요", abc: { a: "교실이 시끄럽고 정리정돈이 안 된다", b: "학생들이 학급에 애착이 없는 것 같다", c: "실망스럽고 개선하고 싶다" } }
            ],
            "학습 지도": [
                { text: "학습 속도가 다른 학생들을 어떻게 지도할까요", abc: { a: "같은 내용을 가르쳐도 이해 속도가 다르다", b: "모든 학생을 다 챙기기 어렵다", c: "미안하고 방법을 찾고 싶다" } },
                { text: "숙제를 안 해오는 학생이 많아요", abc: { a: "매일 숙제를 안 해오는 학생들이 있다", b: "학습에 대한 의욕이 없는 것 같다", c: "어떻게 동기를 줘야 할지 모르겠다" } },
                { text: "시험 성적이 전반적으로 낮아요", abc: { a: "반 평균이 다른 반보다 낮다", b: "내 교수법에 문제가 있나보다", c: "자책하며 개선 방법을 찾고 있다" } }
            ],
            "학부모 관계": [
                { text: "학부모가 너무 간섭이 심해요", abc: { a: "학부모가 수업 방식에 대해 자주 문의한다", b: "내 전문성을 인정하지 않는 것 같다", c: "부담스럽고 위축된다" } },
                { text: "학부모와 교육 방침이 달라요", abc: { a: "가정과 학교의 교육 방식이 다르다", b: "학생이 혼란스러워할 것 같다", c: "어떻게 조율해야 할지 고민된다" } },
                { text: "상담 요청이 너무 많아요", abc: { a: "매주 여러 학부모가 상담을 요청한다", b: "모든 요구를 다 들어줘야 하나", c: "시간이 부족하고 피곤하다" } }
            ],
            "업무 스트레스": [
                { text: "업무가 너무 많아서 힘들어요", abc: { a: "수업 외에도 행정업무가 산더미다", b: "이 모든 걸 다 해내야 한다", c: "지치고 번아웃이 올 것 같다" } },
                { text: "수업 준비할 시간이 부족해요", abc: { a: "회의와 업무로 수업 준비 시간이 없다", b: "학생들에게 미안하다", c: "죄책감과 스트레스를 느낀다" } },
                { text: "동료 교사와의 관계가 어려워요", abc: { a: "다른 선생님과 의견이 자주 충돌한다", b: "혼자만 다른 생각을 하는 것 같다", c: "외롭고 소통이 어렵다" } }
            ]
        };

        const emotions = [
            { name: "속상함", emoji: "😢", empathy: "정말 속상하셨을 것 같아요. 그런 마음 충분히 이해해요." },
            { name: "걱정됨", emoji: "😰", empathy: "많이 걱정되시는군요. 그런 고민을 하시는 선생님의 마음이 느껴져요." },
            { name: "답답함", emoji: "😤", empathy: "정말 답답하셨을 거예요. 어떻게 해야 할지 막막하셨을 것 같아요." },
            { name: "스트레스", emoji: "😵", empathy: "스트레스가 많이 쌓이셨나봐요. 힘드셨을 텐데 이렇게 고민해주셔서 고마워요." },
            { name: "실망", emoji: "😞", empathy: "실망스러우셨을 거예요. 기대했던 것과 달라서 더 속상하셨을 것 같아요." },
            { name: "부담", emoji: "😓", empathy: "많은 부담을 느끼고 계시는군요. 그런 마음 정말 공감해요." },
            { name: "미안함", emoji: "😔", empathy: "미안한 마음이 드시는군요. 그런 마음을 가지시는 것만으로도 좋은 선생님이세요." },
            { name: "피곤함", emoji: "😴", empathy: "정말 피곤하셨을 거예요. 쉬는 시간도 부족하실 텐데 고생이 많으세요." }
        ];

        const situationBasedChecklists = {
            "수업 참여": {
                thinking: [
                    "제가 재미있게 느꼈던 수업은 게임이나 활동이 있었어요",
                    "질문을 받을 때 틀릴까봐 걱정되는 마음도 있어요",
                    "친구들과 함께 하는 활동이 더 참여하고 싶게 만들어요",
                    "선생님이 웃으면서 격려해주시면 용기가 나요",
                    "작은 성공 경험이 있으면 더 적극적이 되어요"
                ],
                help: [
                    "손들기 전에 짝과 먼저 이야기해보는 시간 주기",
                    "정답이 아니어도 칭찬해주는 분위기 만들기",
                    "조별 활동으로 부담 줄여주기",
                    "재미있는 퀴즈나 게임 활동 추가하기",
                    "발표 대신 그림이나 글로 표현할 기회 주기"
                ]
            },
            "학급 관리": {
                thinking: [
                    "규칙이 너무 많으면 기억하기 어려워요",
                    "왜 그 규칙이 필요한지 이유를 알고 싶어요",
                    "친구들과 함께 정한 규칙은 더 잘 지키게 되어요",
                    "칭찬받을 때 규칙을 지키고 싶은 마음이 더 생겨요",
                    "벌보다는 보상이 더 동기가 되어요"
                ],
                help: [
                    "학급 규칙을 함께 정하는 시간 만들기",
                    "규칙을 지킨 친구들 칭찬하기",
                    "교실 꾸미기나 정리를 함께 하기",
                    "역할 분담으로 책임감 느끼게 하기",
                    "갈등 해결하는 방법 가르쳐주기"
                ]
            },
            "학습 지도": {
                thinking: [
                    "어려운 문제는 단계별로 나누어 주시면 이해하기 쉬워요",
                    "친구에게 설명해볼 기회가 있으면 더 잘 기억해요",
                    "틀려도 괜찮다는 분위기에서 더 시도하게 되어요",
                    "내가 좋아하는 것과 연결해서 배우면 더 재미있어요",
                    "선생님이 개별적으로 도움주시면 더 집중하게 되어요"
                ],
                help: [
                    "짝 활동으로 서로 가르쳐주는 시간 만들기",
                    "수준별 과제나 선택권 주기",
                    "작은 성취도 인정하고 격려하기",
                    "학생의 관심사와 연결한 예시 사용하기",
                    "숙제 체크리스트나 계획표 함께 만들기"
                ]
            },
            "학부모 관계": {
                thinking: [
                    "부모님이 선생님을 믿고 지지해주시면 좋겠어요",
                    "집과 학교가 다르면 우리도 혼란스러워요",
                    "선생님의 교육 방식에 대해 설명해주시면 이해하기 쉬워요",
                    "부모님과 선생님이 협력하는 모습을 보면 안심돼요",
                    "선생님이 우리를 위해 노력하신다는 걸 부모님도 알면 좋겠어요"
                ],
                help: [
                    "교육 철학이나 방법을 편지로 설명하기",
                    "학생의 성장 과정을 사진이나 영상으로 공유하기",
                    "학부모 참여 활동 기획하기",
                    "정기적인 소통 시간 정하기",
                    "학생의 장점을 먼저 이야기하기"
                ]
            },
            "업무 스트레스": {
                thinking: [
                    "선생님이 힘들어하시면 우리도 걱정돼요",
                    "선생님도 쉬는 시간이 필요하다고 생각해요",
                    "선생님이 웃으시면 교실 분위기가 좋아져요",
                    "우리가 도울 수 있는 일이 있으면 말해주세요",
                    "선생님의 건강이 가장 중요해요"
                ],
                help: [
                    "학생들과 업무 분담하기 (청소, 정리 등)",
                    "간단한 업무는 학생 도우미 활용하기",
                    "동료 선생님과 협력 체계 만들기",
                    "완벽하지 않아도 된다는 마음가짐 갖기",
                    "휴식 시간 확보하고 자기 돌봄하기"
                ]
            }
        };

        const encouragementMessages = [
            "선생님의 고민하는 마음 자체가 학생들에 대한 사랑이에요! 💖",
            "완벽한 선생님은 없어요. 지금도 충분히 멋진 선생님이세요! ⭐",
            "학생들은 선생님이 생각하는 것보다 훨씬 선생님을 좋아해요! 😊",
            "작은 변화도 큰 차이를 만들어요. 포기하지 마세요! 🌱",
            "선생님의 노력하는 모습을 학생들이 모두 보고 있어요! 👀",
            "힘들 때는 쉬어도 괜찮아요. 선생님의 건강이 우선이에요! 🍃",
            "학생들에게 물어보세요. 분명 좋은 아이디어를 줄 거예요! 💡",
            "선생님만의 특별한 방법이 있을 거예요. 자신감을 가지세요! 💪",
            "실수해도 괜찮아요. 그것도 우리에게는 좋은 배움이에요! 📚",
            "선생님이 있어서 우리 교실이 따뜻해요. 감사해요! 🏠"
        ];

        const commitmentOptions = [
            "우리가 더 적극적으로 참여하도록 노력할게요",
            "선생님이 힘들어하시면 바로 도와드릴게요",
            "친구들과 사이좋게 지내도록 더 노력할게요",
            "수업 시간에 더 집중하도록 할게요",
            "선생님께 감사한 마음을 자주 표현할게요",
            "교실 정리정돈을 더 잘 할게요",
            "다른 친구들도 배려하는 마음을 가질게요",
            "선생님의 새로운 아이디어를 응원할게요"
        ];

        // 초기화
        function init() {
            renderWorryCategories();
            renderEmotionButtons();
            renderCommitmentOptions();
            updateProgress();
        }

        // 고민 카테고리 렌더링
        function renderWorryCategories() {
            const container = document.getElementById('worryCategories');
            container.innerHTML = '';
            
            Object.keys(worryCases).forEach(category => {
                const div = document.createElement('div');
                div.className = 'worry-card bg-white border-2 border-gray-200 rounded-lg p-4 text-center';
                div.onclick = () => selectWorryCategory(category);
                div.innerHTML = `
                    <h3 class="font-semibold text-gray-800 mb-2">${category}</h3>
                    <p class="text-sm text-gray-600">${worryCases[category].length}개의 사례</p>
                `;
                container.appendChild(div);
            });
        }

        // 감정 버튼 렌더링
        function renderEmotionButtons() {
            const container = document.getElementById('emotionButtons');
            container.innerHTML = '';
            
            emotions.forEach(emotion => {
                const button = document.createElement('button');
                button.className = 'emotion-btn bg-white border-2 border-gray-200 rounded-lg p-4 text-center';
                button.onclick = () => selectEmotion(emotion);
                button.innerHTML = `
                    <div class="text-3xl mb-2">${emotion.emoji}</div>
                    <div class="font-medium">${emotion.name}</div>
                `;
                container.appendChild(button);
            });
        }

        // 실천 약속 옵션 렌더링
        function renderCommitmentOptions() {
            const container = document.getElementById('commitmentOptions');
            container.innerHTML = '';
            
            commitmentOptions.forEach((option, index) => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer';
                label.innerHTML = `
                    <input type="checkbox" value="${index}" onchange="toggleCommitment(${index})" class="rounded">
                    <span class="text-sm">${option}</span>
                `;
                container.appendChild(label);
            });
        }

        // 고민 카테고리 선택
        function selectWorryCategory(category) {
            // 기존 선택 해제
            document.querySelectorAll('.worry-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.worry-card').classList.add('selected');
            
            selectedCategory = category;
            
            // 상황 선택 화면으로 전환
            document.getElementById('categorySelection').classList.add('hidden');
            document.getElementById('situationSelection').classList.remove('hidden');
            document.getElementById('selectedCategoryTitle').textContent = `${category} 관련 고민`;
            
            // 구체적 상황 목록 렌더링
            renderSituationList(category);
        }

        // 구체적 상황 목록 렌더링
        function renderSituationList(category) {
            const container = document.getElementById('situationList');
            container.innerHTML = '';
            
            worryCases[category].forEach((situation, index) => {
                const div = document.createElement('div');
                div.className = 'situation-card rounded-lg p-4';
                div.onclick = () => selectSpecificSituation(category, situation, index);
                div.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-semibold text-sm">
                            ${index + 1}
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 font-medium">${situation.text}</p>
                            <div class="mt-2 text-sm text-gray-600">
                                <div class="grid grid-cols-3 gap-2">
                                    <div><span class="font-semibold text-red-600">A:</span> ${situation.abc.a.substring(0, 20)}...</div>
                                    <div><span class="font-semibold text-yellow-600">B:</span> ${situation.abc.b.substring(0, 20)}...</div>
                                    <div><span class="font-semibold text-blue-600">C:</span> ${situation.abc.c.substring(0, 20)}...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // 구체적 상황 선택
        function selectSpecificSituation(category, situation, index) {
            // 기존 선택 해제
            document.querySelectorAll('.situation-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.situation-card').classList.add('selected');
            
            selectedWorry = { category, case: situation, index };
            
            // ABC 필드 채우기
            fillABCFields(situation.abc);
            
            // 직접 입력 텍스트 초기화
            document.getElementById('customWorry').value = '';
            
            // 다음 버튼 활성화
            document.getElementById('step2Next').disabled = false;
        }

        // 카테고리 선택으로 돌아가기
        function backToCategories() {
            document.getElementById('situationSelection').classList.add('hidden');
            document.getElementById('categorySelection').classList.remove('hidden');
            
            // 선택 초기화
            selectedWorry = null;
            selectedCategory = null;
            document.getElementById('customWorry').value = '';
            document.getElementById('step2Next').disabled = true;
            
            // 카테고리 선택 해제
            document.querySelectorAll('.worry-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // 직접 입력 체크
        function checkCustomWorryInput() {
            const customWorry = document.getElementById('customWorry').value.trim();
            const nextBtn = document.getElementById('step2Next');
            
            if (customWorry.length > 0 && selectedCategory) {
                // 기존 상황 선택 해제
                document.querySelectorAll('.situation-card').forEach(card => {
                    card.classList.remove('selected');
                });
                selectedWorry = null;
                nextBtn.disabled = false;
            } else if (selectedWorry) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
        }

        // ABC 필드 채우기
        function fillABCFields(abc) {
            document.getElementById('factA').value = abc.a;
            document.getElementById('beliefB').value = abc.b;
            document.getElementById('consequenceC').value = abc.c;
        }

        // 감정 선택
        function selectEmotion(emotion) {
            // 기존 선택 해제
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.emotion-btn').classList.add('selected');
            
            selectedEmotion = emotion;
            
            // 공감 메시지 표시
            document.getElementById('empathyText').textContent = emotion.empathy;
            document.getElementById('empathyMessage').classList.remove('hidden');
            
            // 다음 버튼 활성화
            document.getElementById('step4Next').disabled = false;
        }

        // 조언 체크리스트 렌더링
        function renderAdviceChecklists() {
            if (!selectedWorry || !selectedCategory) return;
            
            const category = selectedCategory;
            const checklists = situationBasedChecklists[category];
            
            // 생각 체크리스트
            const thinkingContainer = document.getElementById('thinkingChecklist');
            thinkingContainer.innerHTML = '';
            checklists.thinking.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'checklist-item border border-gray-200 rounded p-3';
                div.onclick = () => toggleAdviceItem('thinking', index, item);
                div.innerHTML = `
                    <input type="checkbox" class="mr-2" id="thinking-${index}">
                    <label for="thinking-${index}" class="cursor-pointer">${item}</label>
                `;
                thinkingContainer.appendChild(div);
            });
            
            // 행동 체크리스트
            const helpContainer = document.getElementById('helpChecklist');
            helpContainer.innerHTML = '';
            checklists.help.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'checklist-item border border-gray-200 rounded p-3';
                div.onclick = () => toggleAdviceItem('help', index, item);
                div.innerHTML = `
                    <input type="checkbox" class="mr-2" id="help-${index}">
                    <label for="help-${index}" class="cursor-pointer">${item}</label>
                `;
                helpContainer.appendChild(div);
            });
        }

        // 조언 항목 토글
        function toggleAdviceItem(type, index, item) {
            const checkbox = document.getElementById(`${type}-${index}`);
            const container = checkbox.closest('.checklist-item');
            
            if (checkbox.checked) {
                checkbox.checked = false;
                container.classList.remove('checked');
                selectedAdvice[type] = selectedAdvice[type].filter(i => i !== item);
            } else {
                checkbox.checked = true;
                container.classList.add('checked');
                selectedAdvice[type].push(item);
            }
            
            updateAdvicePreview();
        }

        // 조언 미리보기 업데이트
        function updateAdvicePreview() {
            const hasAdvice = selectedAdvice.thinking.length > 0 || selectedAdvice.help.length > 0;
            
            if (hasAdvice) {
                let adviceText = '';
                
                if (selectedAdvice.thinking.length > 0) {
                    adviceText += '<h4 class="font-semibold mb-2">💭 생각해볼 점:</h4><ul class="list-disc list-inside mb-4">';
                    selectedAdvice.thinking.forEach(item => {
                        adviceText += `<li>${item}</li>`;
                    });
                    adviceText += '</ul>';
                }
                
                if (selectedAdvice.help.length > 0) {
                    adviceText += '<h4 class="font-semibold mb-2">🚀 시도해볼 방법:</h4><ul class="list-disc list-inside">';
                    selectedAdvice.help.forEach(item => {
                        adviceText += `<li>${item}</li>`;
                    });
                    adviceText += '</ul>';
                }
                
                document.getElementById('adviceText').innerHTML = adviceText;
                document.getElementById('advicePreview').classList.remove('hidden');
            } else {
                document.getElementById('advicePreview').classList.add('hidden');
            }
        }

        // 격려 메시지 뽑기
        function drawEncouragementMessage() {
            const randomIndex = Math.floor(Math.random() * encouragementMessages.length);
            const message = encouragementMessages[randomIndex];
            
            document.getElementById('encouragementText').textContent = message;
            document.getElementById('encouragementCard').classList.remove('hidden');
        }

        // 실천 약속 토글
        function toggleCommitment(index) {
            const checkbox = event.target;
            if (checkbox.checked) {
                selectedCommitments.push(commitmentOptions[index]);
            } else {
                selectedCommitments = selectedCommitments.filter(c => c !== commitmentOptions[index]);
            }
        }

        // 다음 단계로 이동
        function nextStep(step) {
            // 유효성 검사
            if (step === 1) {
                const studentName = document.getElementById('studentName').value.trim();
                const teacherName = document.getElementById('teacherName').value.trim();
                if (!studentName || !teacherName) {
                    alert('학생 이름과 선생님 이름을 모두 입력해주세요.');
                    return;
                }
            }
            
            if (step === 2) {
                const customWorry = document.getElementById('customWorry').value.trim();
                if (!selectedWorry && !customWorry) {
                    alert('구체적인 상황을 선택하거나 직접 입력해주세요.');
                    return;
                }
                if (customWorry && selectedCategory) {
                    // 직접 입력한 경우
                    selectedWorry = { 
                        category: selectedCategory, 
                        case: { text: customWorry, abc: { a: "", b: "", c: "" } },
                        isCustom: true
                    };
                }
                if (!selectedWorry) {
                    alert('고민 분야를 먼저 선택해주세요.');
                    return;
                }
            }
            
            // 현재 단계 숨기기
            document.getElementById(`step${step}`).classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('active');
            
            // 다음 단계 보이기
            const nextStep = step + 1;
            document.getElementById(`step${nextStep}`).classList.remove('hidden');
            document.getElementById(`step${nextStep}`).classList.add('active');
            document.getElementById(`step${nextStep}`).scrollIntoView({ behavior: 'smooth' });
            
            currentStep = nextStep;
            updateProgress();
            
            // 특별 처리
            if (nextStep === 5) {
                renderAdviceChecklists();
            }
            if (nextStep === 7) {
                generateFinalResult();
            }
        }

        // 이전 단계로 이동
        function prevStep(step) {
            // 현재 단계 숨기기
            document.getElementById(`step${step}`).classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('active');
            
            // 이전 단계 보이기
            const prevStepNum = step - 1;
            document.getElementById(`step${prevStepNum}`).classList.remove('hidden');
            document.getElementById(`step${prevStepNum}`).classList.add('active');
            document.getElementById(`step${prevStepNum}`).scrollIntoView({ behavior: 'smooth' });
            
            currentStep = prevStepNum;
            updateProgress();
            
            // step2로 돌아갈 때 특별 처리
            if (prevStepNum === 2 && selectedWorry) {
                // 이미 선택된 상태 복원
                if (selectedCategory) {
                    document.getElementById('categorySelection').classList.add('hidden');
                    document.getElementById('situationSelection').classList.remove('hidden');
                    document.getElementById('selectedCategoryTitle').textContent = `${selectedCategory} 관련 고민`;
                    renderSituationList(selectedCategory);
                    
                    // 선택된 상황이 있다면 하이라이트
                    setTimeout(() => {
                        if (selectedWorry && !selectedWorry.isCustom) {
                            const situationCards = document.querySelectorAll('.situation-card');
                            if (situationCards[selectedWorry.index]) {
                                situationCards[selectedWorry.index].classList.add('selected');
                            }
                        }
                    }, 100);
                }
                document.getElementById('step2Next').disabled = false;
            }
        }

        // 진행률 업데이트
        function updateProgress() {
            const progress = ((currentStep - 1) / 6) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
        }

        // 최종 결과 생성
        function generateFinalResult() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const personalMessage = document.getElementById('personalMessage').value;
            
            let resultHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">🌟 ${studentName}의 상담 결과</h3>
                    <p class="text-lg text-gray-600">${teacherName}을 위한 따뜻한 조언</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">📂 고민 분야</h4>
                        <p class="text-gray-600">${selectedCategory}</p>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">💖 선택한 감정</h4>
                        <p class="text-gray-600">${selectedEmotion?.emoji} ${selectedEmotion?.name}</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">📝 고민 상황</h4>
                    <p class="text-gray-600">${selectedWorry?.case.text || '직접 입력한 고민'}</p>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">🎯 학생의 조언</h4>
                    ${document.getElementById('adviceText').innerHTML}
                </div>
            `;
            
            if (document.getElementById('encouragementText').textContent) {
                resultHTML += `
                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200 mt-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">💌 격려 메시지</h4>
                        <p class="text-gray-700">${document.getElementById('encouragementText').textContent}</p>
                    </div>
                `;
            }
            
            if (personalMessage) {
                resultHTML += `
                    <div class="bg-pink-50 rounded-lg p-4 border border-pink-200 mt-4">
                        <h4 class="font-semibold text-pink-800 mb-2">✏️ 개인 메시지</h4>
                        <p class="text-gray-700">${personalMessage}</p>
                    </div>
                `;
            }
            
            if (selectedCommitments.length > 0) {
                resultHTML += `
                    <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-200 mt-4">
                        <h4 class="font-semibold text-indigo-800 mb-2">🤝 우리의 약속</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            ${selectedCommitments.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            document.getElementById('finalResult').innerHTML = resultHTML;
        }

        // 텍스트로 저장
        function saveAsText() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const date = new Date().toLocaleDateString('ko-KR');
            
            let content = `ABC 교사 상담 결과\n`;
            content += `상담일: ${date}\n`;
            content += `상담 학생: ${studentName}\n`;
            content += `상담 대상: ${teacherName}\n\n`;
            
            content += `[고민 분야]\n${selectedCategory}\n\n`;
            content += `[고민 상황]\n${selectedWorry?.case.text || '직접 입력한 고민'}\n\n`;
            
            content += `[ABC 분석]\n`;
            content += `A (사실): ${document.getElementById('factA').value}\n`;
            content += `B (생각): ${document.getElementById('beliefB').value}\n`;
            content += `C (결과): ${document.getElementById('consequenceC').value}\n\n`;
            
            content += `[감정]: ${selectedEmotion?.name}\n\n`;
            
            content += `[학생의 조언]\n`;
            if (selectedAdvice.thinking.length > 0) {
                content += `생각해볼 점:\n`;
                selectedAdvice.thinking.forEach(item => content += `- ${item}\n`);
                content += `\n`;
            }
            if (selectedAdvice.help.length > 0) {
                content += `시도해볼 방법:\n`;
                selectedAdvice.help.forEach(item => content += `- ${item}\n`);
                content += `\n`;
            }
            
            const encouragement = document.getElementById('encouragementText').textContent;
            if (encouragement) {
                content += `[격려 메시지]\n${encouragement}\n\n`;
            }
            
            const personalMessage = document.getElementById('personalMessage').value;
            if (personalMessage) {
                content += `[개인 메시지]\n${personalMessage}\n\n`;
            }
            
            if (selectedCommitments.length > 0) {
                content += `[우리의 약속]\n`;
                selectedCommitments.forEach(c => content += `- ${c}\n`);
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ABC상담결과_${studentName}_${date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 인쇄
        function printResult() {
            const printWindow = window.open('', '_blank');
            const content = document.getElementById('finalResult').innerHTML;
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>ABC 상담 결과</title>
                    <style>
                        body { font-family: 'Noto Sans KR', sans-serif; margin: 20px; }
                        .bg-white { background: white; }
                        .rounded-lg { border-radius: 8px; }
                        .p-4 { padding: 16px; }
                        .border { border: 1px solid #e5e7eb; }
                        .mb-2 { margin-bottom: 8px; }
                        .mb-4 { margin-bottom: 16px; }
                        .mt-4 { margin-top: 16px; }
                        .font-semibold { font-weight: 600; }
                        .text-center { text-align: center; }
                        .grid { display: grid; }
                        .gap-6 { gap: 24px; }
                        @media (min-width: 768px) { .md\\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); } }
                        ul { padding-left: 20px; }
                        li { margin-bottom: 4px; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // 폼 리셋
        function resetForm() {
            if (confirm('정말 새로 시작하시겠습니까? 모든 내용이 삭제됩니다.')) {
                // 변수 초기화
                currentStep = 1;
                selectedWorry = null;
                selectedCategory = null;
                selectedEmotion = null;
                selectedAdvice = { thinking: [], help: [] };
                selectedCommitments = [];
                
                // UI 초기화
                document.getElementById('categorySelection').classList.remove('hidden');
                document.getElementById('situationSelection').classList.add('hidden');
                
                location.reload();
            }
        }

        // 도움말
        function showHelp() {
            alert(`ABC 교사 상담 도구 사용법:

1. 학생과 선생님 이름을 입력합니다
2. 선생님의 고민 상황을 선택하거나 직접 입력합니다  
3. ABC 모델로 상황을 분석합니다 (사실-생각-결과)
4. 선생님의 감정에 공감합니다
5. 학생의 경험을 바탕으로 조언을 제공합니다
6. 격려 메시지와 실천 약속을 정합니다
7. 결과를 저장하거나 인쇄할 수 있습니다

궁금한 점이 있으면 언제든 물어보세요! 😊`);
        }

        // 페이지 로드 시 초기화
        window.onload = init;
    </script>
</body>
</html>