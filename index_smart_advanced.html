<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC êµì‚¬ ìƒë‹´ ë„êµ¬ - ê³ ê¸‰ ìŠ¤ë§ˆíŠ¸ ë¶„ë¥˜ ë²„ì „</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        /* ìŠ¤ë§ˆíŠ¸ ë¶„ë¥˜ ê²°ê³¼ í‘œì‹œ */
        .smart-result {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
            animation: slideDown 0.5s ease;
        }

        .smart-result::before {
            content: 'ğŸ¤–';
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 2rem;
            opacity: 0.7;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ì„ íƒëœ ê³ ë¯¼ ì§€ì† í‘œì‹œ */
        .selected-worry-display {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border: 2px solid #f97316;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            animation: slideDown 0.5s ease;
            position: sticky;
            top: 10px;
            z-index: 10;
        }

        /* í–¥ìƒëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .enhanced-checklist {
            background: rgba(139, 92, 246, 0.03);
            border: 2px solid rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .enhanced-checklist:hover {
            border-color: rgba(139, 92, 246, 0.2);
            background: rgba(139, 92, 246, 0.05);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .checklist-item:hover {
            background: rgba(139, 92, 246, 0.05);
            border-color: rgba(139, 92, 246, 0.1);
        }

        .checklist-item.selected {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .checklist-item input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .checklist-item label {
            flex: 1;
            cursor: pointer;
            line-height: 1.5;
            color: #4b5563;
            font-size: 0.95rem;
        }

        /* ìŠ¤ë§ˆíŠ¸ ë¶„ë¥˜ ì •í™•ë„ í‘œì‹œ */
        .confidence-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s ease;
        }

        /* ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ */
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .category-ìˆ˜ì—…ì°¸ì—¬ { background: #dcfce7; color: #166534; }
        .category-í•™ê¸‰ê´€ë¦¬ { background: #dbeafe; color: #1e40af; }
        .category-í•™ìŠµì§€ë„ { background: #ede9fe; color: #5b21b6; }
        .category-í•™ë¶€ëª¨ê´€ê³„ { background: #fed7aa; color: #9a3412; }
        .category-ì—…ë¬´ìŠ¤íŠ¸ë ˆìŠ¤ { background: #fecaca; color: #991b1b; }

        /* ì‹¤ì‹œê°„ ì¡°ì–¸ ìƒì„± */
        .realtime-advice {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ë‹¨ê³„ë³„ ë„¤ë¹„ê²Œì´ì…˜ */
        .step-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* 7ë‹¨ê³„ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¸°ê¸° */
        .step-nav.hidden-final {
            display: none;
        }
        
        .step-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 8px;
            text-align: center;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.85rem;
            position: relative;
            overflow: hidden;
        }
        
        .step-btn.active {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .step-btn.completed {
            opacity: 0.9;
        }
        
        .step-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .step1-btn { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .step1-btn.active { border-color: #059669; }
        
        .step2-btn { background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); color: #1e40af; }
        .step2-btn.active { border-color: #3b82f6; }
        
        .step3-btn { background: linear-gradient(135deg, #ede9fe 0%, #c4b5fd 100%); color: #5b21b6; }
        .step3-btn.active { border-color: #8b5cf6; }
        
        .step4-btn { background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%); color: #9a3412; }
        .step4-btn.active { border-color: #f97316; }
        
        .step5-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .step5-btn.active { border-color: #f59e0b; }
        
        .step6-btn { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); color: #6b21a8; }
        .step6-btn.active { border-color: #8b5cf6; }

        .step-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .step-card.active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        /* ìµœì¢… ê²°ê³¼ í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼ */
        .final-result-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .final-result-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* ì•Œë¦¼ ì‹œìŠ¤í…œ */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .step-nav {
                flex-direction: column;
                gap: 4px;
            }
            
            .step-btn {
                font-size: 0.8rem;
                padding: 10px 8px;
                min-width: auto;
            }

            .enhanced-checklist {
                padding: 16px;
            }

            .checklist-item {
                padding: 10px;
            }

            .final-result-container {
                padding: 1rem 0;
            }
        }

        /* ì¸ì‡„ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¸°ê¸° */
        @media print {
            .step-nav {
                display: none !important;
            }
            .selected-worry-display {
                position: static;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ§  ABC êµì‚¬ ìƒë‹´ ë„êµ¬</h1>
            <p class="text-lg text-gray-600">ê³ ê¸‰ ìŠ¤ë§ˆíŠ¸ ë¶„ë¥˜ & ë§ì¶¤í˜• ì¡°ì–¸ ì‹œìŠ¤í…œ</p>
            <div class="mt-3 text-sm bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 inline-block px-4 py-2 rounded-full border border-blue-200">
                âœ¨ ğŸ¤– í–¥ìƒëœ AI ë¶„ë¥˜ + ğŸ“ ì‹¤ì‹œê°„ ë§ì¶¤ ì²´í¬ë¦¬ìŠ¤íŠ¸
            </div>
        </div>

        <!-- ë‹¨ê³„ë³„ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="step-nav" id="stepNavigation">
            <button class="step-btn step1-btn active" data-step="1">
                1ï¸âƒ£ ê¸°ë³¸ì •ë³´<br>
                <span class="text-xs opacity-75">ì´ë¦„ ì…ë ¥</span>
            </button>
            <button class="step-btn step2-btn disabled" data-step="2">
                2ï¸âƒ£ ê³ ë¯¼ì…ë ¥<br>
                <span class="text-xs opacity-75">ğŸ¤– ìŠ¤ë§ˆíŠ¸ ë¶„ì„</span>
            </button>
            <button class="step-btn step3-btn disabled" data-step="3">
                3ï¸âƒ£ ABCì •ë¦¬<br>
                <span class="text-xs opacity-75">êµ¬ì¡°ì  ë¶„ì„</span>
            </button>
            <button class="step-btn step4-btn disabled" data-step="4">
                4ï¸âƒ£ ê°ì •ê³µê°<br>
                <span class="text-xs opacity-75">ë§ˆìŒ ì´í•´</span>
            </button>
            <button class="step-btn step5-btn disabled" data-step="5">
                5ï¸âƒ£ ë§ì¶¤ì¡°ì–¸<br>
                <span class="text-xs opacity-75">ğŸ“ ìŠ¤ë§ˆíŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</span>
            </button>
            <button class="step-btn step6-btn disabled" data-step="6">
                6ï¸âƒ£ ê²©ë ¤ì™„ì„±<br>
                <span class="text-xs opacity-75">ì‘ì› ë©”ì‹œì§€</span>
            </button>
        </nav>

        <!-- ì„ íƒëœ ê³ ë¯¼ ì§€ì† í‘œì‹œ (3ë‹¨ê³„ë¶€í„°) -->
        <div id="selectedWorryCard" class="selected-worry-display hidden">
            <div class="flex items-start gap-3">
                <div class="text-2xl">ğŸ¯</div>
                <div class="flex-1">
                    <h3 class="font-semibold text-orange-800 mb-2">ì„ íƒëœ ê³ ë¯¼</h3>
                    <p id="selectedWorryText" class="text-gray-700 mb-2"></p>
                    <div class="flex items-center gap-2">
                        <span id="selectedWorryCategory" class="category-badge"></span>
                        <span id="smartClassificationBadge" class="hidden text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">
                            ğŸ¤– ìë™ë¶„ë¥˜
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë‹¨ê³„ 1: ê¸°ë³¸ ì •ë³´ ì…ë ¥ -->
        <div class="step-card active border-2 rounded-lg p-6 mb-6" id="step1">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">1ï¸âƒ£ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¦ ìƒë‹´í•˜ëŠ” í•™ìƒ ì´ë¦„</label>
                    <input type="text" id="studentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ê¹€ë¯¼ìˆ˜">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘©â€ğŸ« ìƒë‹´ë°›ëŠ” ì„ ìƒë‹˜ ì´ë¦„</label>
                    <input type="text" id="teacherName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì´ì˜í¬ ì„ ìƒë‹˜">
                </div>
            </div>
            <div class="mt-6 text-right">
                <button onclick="nextStep(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 2: ê³ ë¯¼ ì…ë ¥ (ìŠ¤ë§ˆíŠ¸ ë¶„ì„) -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step2">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">2ï¸âƒ£ ì„ ìƒë‹˜ì˜ ê³ ë¯¼ì„ ì•Œë ¤ì£¼ì„¸ìš”</h2>
            
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-blue-800 mb-3">ğŸ¤– ê³ ê¸‰ ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ì‹œìŠ¤í…œ</h3>
                <p class="text-sm text-gray-600 mb-3">
                    ê³ ë¯¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì‹œë©´ AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ê°€ì¥ ì í•©í•œ ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ê³ , 
                    ë§ì¶¤í˜• ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì¤€ë¹„í•©ë‹ˆë‹¤!
                </p>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-2 text-xs">
                    <span class="category-badge category-ìˆ˜ì—…ì°¸ì—¬">ğŸ“š ìˆ˜ì—… ì°¸ì—¬</span>
                    <span class="category-badge category-í•™ê¸‰ê´€ë¦¬">ğŸ‘¥ í•™ê¸‰ ê´€ë¦¬</span>
                    <span class="category-badge category-í•™ìŠµì§€ë„">ğŸ“– í•™ìŠµ ì§€ë„</span>
                    <span class="category-badge category-í•™ë¶€ëª¨ê´€ê³„">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ í•™ë¶€ëª¨ ê´€ê³„</span>
                    <span class="category-badge category-ì—…ë¬´ìŠ¤íŠ¸ë ˆìŠ¤">ğŸ’¼ ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤</span>
                </div>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">ê³ ë¯¼ ìƒí™©ì„ ìì„¸íˆ ì ì–´ì£¼ì„¸ìš”</label>
                <textarea 
                    id="worryInput" 
                    class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                    rows="4" 
                    placeholder="ì˜ˆ: ìˆ˜ì—… ì‹œê°„ì— í•™ìƒë“¤ì´ ì§‘ì¤‘í•˜ì§€ ì•Šê³  ìê¾¸ ë– ë“¤ì–´ìš”. ì§ˆë¬¸ì„ í•´ë„ ëŒ€ë‹µí•˜ëŠ” í•™ìƒì´ ê±°ì˜ ì—†ê³ , ë°œí‘œë¥¼ ì‹œì¼œë„ ì†Œê·¹ì ì…ë‹ˆë‹¤..."
                    oninput="analyzeWorryInput()"
                ></textarea>
                <div class="text-xs text-gray-500 mt-1">ğŸ’¡ êµ¬ì²´ì ìœ¼ë¡œ ì ì„ìˆ˜ë¡ ë” ì •í™•í•œ ë¶„ì„ê³¼ ë§ì¶¤ ì¡°ì–¸ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</div>
            </div>

            <!-- ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê²°ê³¼ -->
            <div id="smartAnalysisResult" class="hidden smart-result">
                <h3 class="font-semibold text-sky-700 mb-3">ğŸ¯ ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê²°ê³¼</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <div class="flex items-center mb-2">
                            <span class="text-sm font-medium text-gray-600">ë¶„ë¥˜ëœ ì¹´í…Œê³ ë¦¬:</span>
                            <span id="detectedCategoryBadge" class="ml-2"></span>
                        </div>
                        <div class="text-sm text-gray-600 mb-2">ë¶„ë¥˜ ì •í™•ë„:</div>
                        <div class="confidence-bar">
                            <div id="confidenceLevel" class="confidence-fill" style="width: 0%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1" id="confidenceText">ë¶„ì„ ì¤‘...</div>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-600 mb-2">ê°ì§€ëœ í‚¤ì›Œë“œ:</div>
                        <div id="detectedKeywords" class="flex flex-wrap gap-1"></div>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <div class="text-sm text-blue-700" id="analysisInsight"></div>
                </div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(2)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">â† ì´ì „</button>
                <button onclick="nextStep(2)" id="step2Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>ë‹¤ìŒ ë‹¨ê³„ â†’</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 3: ABC ì •ë¦¬ -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step3">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">3ï¸âƒ£ ABCë¡œ ìƒí™©ì„ ì •ë¦¬í•´ë³´ì•„ìš”</h2>
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold text-red-700 mb-2">ğŸ…°ï¸ ì‚¬ì‹¤ (Facts)</h3>
                    <p class="text-sm text-gray-600 mb-2">ì‹¤ì œë¡œ ì¼ì–´ë‚œ ì¼</p>
                    <textarea id="factA" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-700 mb-2">ğŸ…±ï¸ ìƒê° (Beliefs)</h3>
                    <p class="text-sm text-gray-600 mb-2">ê·¸ë•Œ ë“  ìƒê°ì´ë‚˜ ë¯¿ìŒ</p>
                    <textarea id="beliefB" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-700 mb-2">ğŸ…²ï¸ ê²°ê³¼ (Consequences)</h3>
                    <p class="text-sm text-gray-600 mb-2">ê·¸ë˜ì„œ ë‚˜íƒ€ë‚œ ê°ì •ì´ë‚˜ í–‰ë™</p>
                    <textarea id="consequenceC" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3"></textarea>
                </div>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(3)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">â† ì´ì „</button>
                <button onclick="nextStep(3)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 4: ê°ì • ê³µê° -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step4">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">4ï¸âƒ£ ì„ ìƒë‹˜ì˜ ê°ì •ì— ê³µê°í•´ì£¼ì„¸ìš”</h2>
            <p class="text-gray-600 mb-6">ì„ ìƒë‹˜ì´ ì§€ê¸ˆ ì–´ë–¤ ê¸°ë¶„ì´ì‹¤ê¹Œìš”? ê°€ì¥ ê°€ê¹Œìš´ ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6" id="emotionButtons">
                <!-- ê°ì • ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 hidden" id="empathyMessage">
                <h3 class="font-medium text-green-700 mb-2">ğŸ’š ê³µê° ë©”ì‹œì§€</h3>
                <p id="empathyText" class="text-gray-700"></p>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(4)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">â† ì´ì „</button>
                <button onclick="nextStep(4)" id="step4Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>ë‹¤ìŒ ë‹¨ê³„ â†’</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 5: ë§ì¶¤í˜• ì¡°ì–¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step5">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">5ï¸âƒ£ ìŠ¤ë§ˆíŠ¸ ë§ì¶¤ ì¡°ì–¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
            
            <!-- ë¶„ë¥˜ ê²°ê³¼ ê¸°ë°˜ ì•ˆë‚´ -->
            <div id="customizedAdviceIntro" class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4 mb-6">
                <h3 class="font-semibold text-purple-800 mb-2">ğŸ¯ ë§ì¶¤í˜• ì¡°ì–¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
                <p class="text-sm text-gray-600" id="adviceIntroText">
                    ë¶„ì„ëœ ê³ ë¯¼ ìœ í˜•ì— ë”°ë¼ ê°€ì¥ íš¨ê³¼ì ì¸ ì¡°ì–¸ë“¤ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤!
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- ìƒê°í•´ë³¼ ì  -->
                <div class="enhanced-checklist">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="text-lg font-semibold text-purple-700">ğŸ¤” ìƒê°í•´ë³¼ ì </h3>
                            <span id="thinkingCount" class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full">0ê°œ ì„ íƒ</span>
                        </div>
                        <button onclick="applyThinkingChecklist()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ğŸ“ ì ìš©í•˜ê¸°
                        </button>
                    </div>
                    <div id="customThinkingChecklist" class="space-y-1 mb-4">
                        <!-- ë§ì¶¤í˜• ìƒê° ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                    <textarea id="thinking-textarea" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="4" placeholder="ì„ íƒí•œ ìƒê°ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤..."></textarea>
                </div>
                
                <!-- í–‰ë™ ì•„ì´ë””ì–´ -->
                <div class="enhanced-checklist">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="text-lg font-semibold text-cyan-700">ğŸ¯ í–‰ë™ ì•„ì´ë””ì–´</h3>
                            <span id="actionCount" class="text-xs bg-cyan-100 text-cyan-600 px-2 py-1 rounded-full">0ê°œ ì„ íƒ</span>
                        </div>
                        <button onclick="applyActionChecklist()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ğŸ¯ ì ìš©í•˜ê¸°
                        </button>
                    </div>
                    <div id="customActionChecklist" class="space-y-1 mb-4">
                        <!-- ë§ì¶¤í˜• í–‰ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                    <textarea id="action-textarea" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent" rows="4" placeholder="ì„ íƒí•œ ë°©ë²•ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤..."></textarea>
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì¡°ì–¸ ë¯¸ë¦¬ë³´ê¸° -->
            <div id="realtimeAdvicePreview" class="hidden realtime-advice">
                <h3 class="font-semibold text-green-700 mb-3">âœ¨ ìƒì„±ëœ ì¡°ì–¸ ë¯¸ë¦¬ë³´ê¸°</h3>
                <div id="advicePreviewContent" class="text-gray-700"></div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(5)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">â† ì´ì „</button>
                <button onclick="nextStep(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 6: ê²©ë ¤ ë©”ì‹œì§€ -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">6ï¸âƒ£ ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ì „í•´ì£¼ì„¸ìš”</h2>
            
            <div class="text-center mb-6">
                <button onclick="drawEncouragementMessage()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-lg font-medium text-lg transition-colors">
                    ğŸ¯ ê²©ë ¤ ë©”ì‹œì§€ ë½‘ê¸°
                </button>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6 hidden" id="encouragementCard">
                <h3 class="font-semibold text-yellow-800 mb-3 text-center">ğŸ’Œ ë½‘íŒ ê²©ë ¤ ë©”ì‹œì§€</h3>
                <p id="encouragementText" class="text-gray-800 text-center text-lg font-medium"></p>
            </div>

            <div class="bg-pink-50 border border-pink-200 rounded-lg p-4 mb-6">
                <h3 class="font-medium text-pink-700 mb-2">âœï¸ ê°œì¸ì ì¸ ë©”ì‹œì§€ ì¶”ê°€</h3>
                <textarea id="personalMessage" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" rows="3" placeholder="ì„ ìƒë‹˜ê»˜ ì „í•˜ê³  ì‹¶ì€ ê°œì¸ì ì¸ ì‘ì› ë©”ì‹œì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(6)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">â† ì´ì „</button>
                <button onclick="nextStep(6)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">ì™„ì„±í•˜ê¸° ğŸ‰</button>
            </div>
        </div>

        <!-- ë‹¨ê³„ 7: ê²°ê³¼ í™•ì¸ ë° ì €ì¥ -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step7">
            <!-- ìµœì¢… ê²°ê³¼ í™”ë©´ì—ëŠ” ë„¤ë¹„ê²Œì´ì…˜ì´ ìˆ¨ê²¨ì§€ê³  ê¹”ë”í•œ ê²°ê³¼ë§Œ í‘œì‹œ -->
            <div class="final-result-card">
                <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">ğŸ‰ ìƒë‹´ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6" id="finalResult">
                    <!-- ìµœì¢… ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <button onclick="saveAsText()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        ğŸ“„ í…ìŠ¤íŠ¸ë¡œ ì €ì¥
                    </button>
                    <button onclick="printResult()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                    </button>
                    <button onclick="resetForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        ğŸ”„ ìƒˆë¡œ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ ì‹œìŠ¤í…œ -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentStep = 1;
        let selectedWorry = null;
        let detectedCategory = null;
        let analysisConfidence = 0;
        let detectedKeywords = [];
        let selectedEmotion = null;
        let selectedThinking = [];
        let selectedActions = [];

        // ğŸ§  ê³ ê¸‰ ìŠ¤ë§ˆíŠ¸ ë¶„ë¥˜ ì‹œìŠ¤í…œ
        const advancedClassificationSystem = {
            categories: {
                'ìˆ˜ì—… ì°¸ì—¬': {
                    keywords: ['ì§‘ì¤‘', 'ë– ë“¤', 'ì§ˆë¬¸', 'ëŒ€ë‹µ', 'ë°œí‘œ', 'ì†Œê·¹ì ', 'ì°¸ì—¬', 'ìˆ˜ì—…', 'ì‹œê°„', 'í™œë™', 'í•™ìŠµ', 'íƒœë„', 'ê´€ì‹¬', 'ëª°ì…', 'ì‚°ë§Œ'],
                    weight: {
                        'ì§‘ì¤‘': 3, 'ë– ë“¤': 3, 'ì§ˆë¬¸': 2, 'ëŒ€ë‹µ': 2, 'ë°œí‘œ': 2, 'ì°¸ì—¬': 3, 'ìˆ˜ì—…': 1, 'í™œë™': 2, 'ì†Œê·¹ì ': 2, 'ê´€ì‹¬': 2
                    },
                    thinking: [
                        "ì œê°€ ì¬ë¯¸ìˆê²Œ ëŠê¼ˆë˜ ìˆ˜ì—…ì€ ê²Œì„ì´ë‚˜ í™œë™ì´ ìˆì—ˆì–´ìš”",
                        "ì§ˆë¬¸ì„ ë°›ì„ ë•Œ í‹€ë¦´ê¹Œë´ ê±±ì •ë˜ëŠ” ë§ˆìŒë„ ìˆì–´ìš”", 
                        "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ í•˜ëŠ” í™œë™ì´ ë” ì°¸ì—¬í•˜ê³  ì‹¶ê²Œ ë§Œë“¤ì–´ìš”",
                        "ì„ ìƒë‹˜ì´ ì›ƒìœ¼ë©´ì„œ ê²©ë ¤í•´ì£¼ì‹œë©´ ìš©ê¸°ê°€ ë‚˜ìš”",
                        "ì‘ì€ ì„±ê³µ ê²½í—˜ì´ ìˆìœ¼ë©´ ë” ì ê·¹ì ì´ ë˜ì–´ìš”",
                        "ìˆ˜ì—… ë‚´ìš©ì´ ìš°ë¦¬ ì¼ìƒê³¼ ì—°ê²°ë˜ë©´ ë” í¥ë¯¸ë¡œì›Œìš”",
                        "ì„ ìƒë‹˜ì´ í•™ìƒ ê°œê°œì¸ì„ ì¸ì •í•´ì£¼ì‹œë©´ ê¸°ë¶„ì´ ì¢‹ì•„ìš”"
                    ],
                    actions: [
                        "ì†ë“¤ê¸° ì „ì— ì§ê³¼ ë¨¼ì € ì´ì•¼ê¸°í•´ë³´ëŠ” ì‹œê°„ ì£¼ê¸°",
                        "ì •ë‹µì´ ì•„ë‹ˆì–´ë„ ì¹­ì°¬í•´ì£¼ëŠ” ë¶„ìœ„ê¸° ë§Œë“¤ê¸°",
                        "ì¡°ë³„ í™œë™ìœ¼ë¡œ ë¶€ë‹´ ì¤„ì—¬ì£¼ê¸°",
                        "ì¬ë¯¸ìˆëŠ” í€´ì¦ˆë‚˜ ê²Œì„ í™œë™ ì¶”ê°€í•˜ê¸°",
                        "ë°œí‘œ ëŒ€ì‹  ê·¸ë¦¼ì´ë‚˜ ê¸€ë¡œ í‘œí˜„í•  ê¸°íšŒ ì£¼ê¸°",
                        "í•™ìƒì˜ ê´€ì‹¬ì‚¬ì™€ ì—°ê²°í•œ ìˆ˜ì—… ë‚´ìš© ì„¤ê³„í•˜ê¸°",
                        "ì†Œê·¸ë£¹ í† ë¡ ìœ¼ë¡œ ë°œì–¸ ê¸°íšŒ ëŠ˜ë¦¬ê¸°"
                    ]
                },
                'í•™ê¸‰ ê´€ë¦¬': {
                    keywords: ['ì‹¸ì›Œ', 'ê·œì¹™', 'ì§€í‚¤ì§€', 'ì–´ìˆ˜ì„ ', 'ë¶„ìœ„ê¸°', 'ê´€ë¦¬', 'í•™ê¸‰', 'ì •ë¦¬', 'ê°ˆë“±', 'ë¬¸ì œ', 'í–‰ë™', 'ì§ˆì„œ', 'ì•½ì†', 'í˜‘ë ¥'],
                    weight: {
                        'ì‹¸ì›Œ': 3, 'ê·œì¹™': 3, 'ê°ˆë“±': 3, 'ë¶„ìœ„ê¸°': 2, 'ê´€ë¦¬': 2, 'í•™ê¸‰': 2, 'ì§ˆì„œ': 2, 'ì–´ìˆ˜ì„ ': 2, 'ë¬¸ì œ': 1
                    },
                    thinking: [
                        "ê·œì¹™ì´ ë„ˆë¬´ ë§ìœ¼ë©´ ê¸°ì–µí•˜ê¸° ì–´ë ¤ì›Œìš”",
                        "ì™œ ê·¸ ê·œì¹™ì´ í•„ìš”í•œì§€ ì´ìœ ë¥¼ ì•Œê³  ì‹¶ì–´ìš”",
                        "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì •í•œ ê·œì¹™ì€ ë” ì˜ ì§€í‚¤ê²Œ ë˜ì–´ìš”",
                        "ì¹­ì°¬ë°›ì„ ë•Œ ê·œì¹™ì„ ì§€í‚¤ê³  ì‹¶ì€ ë§ˆìŒì´ ë” ìƒê²¨ìš”",
                        "ë²Œë³´ë‹¤ëŠ” ë³´ìƒì´ ë” ë™ê¸°ê°€ ë˜ì–´ìš”",
                        "í•™ê¸‰ì˜ ì¼ì›ì´ë¼ëŠ” ì†Œì†ê°ì´ ìˆìœ¼ë©´ ë” í˜‘ë ¥í•˜ê²Œ ë˜ì–´ìš”",
                        "ì„ ìƒë‹˜ì´ ê³µì •í•˜ê²Œ ëŒ€í•´ì£¼ì‹œë©´ ì‹ ë¢°ê°€ ìƒê²¨ìš”"
                    ],
                    actions: [
                        "í•™ê¸‰ ê·œì¹™ì„ í•¨ê»˜ ì •í•˜ëŠ” ì‹œê°„ ë§Œë“¤ê¸°",
                        "ê·œì¹™ì„ ì§€í‚¨ ì¹œêµ¬ë“¤ ì¹­ì°¬í•˜ê¸°",
                        "êµì‹¤ ê¾¸ë¯¸ê¸°ë‚˜ ì •ë¦¬ë¥¼ í•¨ê»˜ í•˜ê¸°",
                        "ì—­í•  ë¶„ë‹´ìœ¼ë¡œ ì±…ì„ê° ëŠë¼ê²Œ í•˜ê¸°",
                        "ê°ˆë“± í•´ê²°í•˜ëŠ” ë°©ë²• ê°€ë¥´ì³ì£¼ê¸°",
                        "í•™ê¸‰ íšŒì˜ ì‹œê°„ ì •ê¸°ì ìœ¼ë¡œ ê°–ê¸°",
                        "ê¸ì •ì ì¸ í•™ê¸‰ ë¬¸í™” ë§Œë“¤ê¸° í™œë™í•˜ê¸°"
                    ]
                },
                'í•™ìŠµ ì§€ë„': {
                    keywords: ['ì†ë„', 'ìˆ™ì œ', 'ì„±ì ', 'ì´í•´', 'ê³µë¶€', 'í•™ìŠµ', 'ì§€ë„', 'ë¬¸ì œ', 'ê³¼ì œ', 'ì ìˆ˜', 'ì‹¤ë ¥', 'ì§„ë„', 'í‰ê°€', 'ì„±ì·¨'],
                    weight: {
                        'ìˆ™ì œ': 3, 'ì„±ì ': 3, 'í•™ìŠµ': 3, 'ì´í•´': 2, 'ì§€ë„': 2, 'ê³¼ì œ': 2, 'í‰ê°€': 2, 'ì§„ë„': 2, 'ê³µë¶€': 1
                    },
                    thinking: [
                        "ì–´ë ¤ìš´ ë¬¸ì œëŠ” ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ„ì–´ ì£¼ì‹œë©´ ì´í•´í•˜ê¸° ì‰¬ì›Œìš”",
                        "ì¹œêµ¬ì—ê²Œ ì„¤ëª…í•´ë³¼ ê¸°íšŒê°€ ìˆìœ¼ë©´ ë” ì˜ ê¸°ì–µí•´ìš”",
                        "í‹€ë ¤ë„ ê´œì°®ë‹¤ëŠ” ë¶„ìœ„ê¸°ì—ì„œ ë” ì‹œë„í•˜ê²Œ ë˜ì–´ìš”",
                        "ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ê²ƒê³¼ ì—°ê²°í•´ì„œ ë°°ìš°ë©´ ë” ì¬ë¯¸ìˆì–´ìš”",
                        "ì„ ìƒë‹˜ì´ ê°œë³„ì ìœ¼ë¡œ ë„ì›€ì£¼ì‹œë©´ ë” ì§‘ì¤‘í•˜ê²Œ ë˜ì–´ìš”",
                        "í•™ìŠµ ëª©í‘œë¥¼ ëª…í™•íˆ ì•Œë©´ ë” ë™ê¸°ê°€ ìƒê²¨ìš”",
                        "ì‘ì€ ì„±ì·¨ë„ ì¸ì •ë°›ìœ¼ë©´ ê³„ì† ë…¸ë ¥í•˜ê²Œ ë˜ì–´ìš”"
                    ],
                    actions: [
                        "ì§ í™œë™ìœ¼ë¡œ ì„œë¡œ ê°€ë¥´ì³ì£¼ëŠ” ì‹œê°„ ë§Œë“¤ê¸°",
                        "ìˆ˜ì¤€ë³„ ê³¼ì œë‚˜ ì„ íƒê¶Œ ì£¼ê¸°",
                        "ì‘ì€ ì„±ì·¨ë„ ì¸ì •í•˜ê³  ê²©ë ¤í•˜ê¸°",
                        "í•™ìƒì˜ ê´€ì‹¬ì‚¬ì™€ ì—°ê²°í•œ ì˜ˆì‹œ ì‚¬ìš©í•˜ê¸°",
                        "ìˆ™ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë‚˜ ê³„íší‘œ í•¨ê»˜ ë§Œë“¤ê¸°",
                        "í•™ìŠµ ë°©ë²•ì„ ë‹¤ì–‘í™”í•˜ê¸°",
                        "ê°œë³„ ë§ì¶¤ í”¼ë“œë°± ì œê³µí•˜ê¸°"
                    ]
                },
                'í•™ë¶€ëª¨ ê´€ê³„': {
                    keywords: ['ê°„ì„­', 'ë¬¸ì˜', 'ìƒë‹´', 'êµìœ¡ë°©ì¹¨', 'í•™ë¶€ëª¨', 'ë¶€ëª¨ë‹˜', 'ê°€ì •', 'ìš”ì²­', 'í˜‘ë ¥', 'ì†Œí†µ', 'ê¸°ëŒ€', 'ì••ë°•'],
                    weight: {
                        'í•™ë¶€ëª¨': 3, 'ë¶€ëª¨ë‹˜': 3, 'ê°„ì„­': 3, 'ìƒë‹´': 2, 'ë¬¸ì˜': 2, 'ê°€ì •': 2, 'í˜‘ë ¥': 2, 'ì†Œí†µ': 2, 'ìš”ì²­': 1
                    },
                    thinking: [
                        "ë¶€ëª¨ë‹˜ì´ ì„ ìƒë‹˜ì„ ë¯¿ê³  ì§€ì§€í•´ì£¼ì‹œë©´ ì¢‹ê² ì–´ìš”",
                        "ì§‘ê³¼ í•™êµê°€ ë‹¤ë¥´ë©´ ìš°ë¦¬ë„ í˜¼ë€ìŠ¤ëŸ¬ì›Œìš”",
                        "ì„ ìƒë‹˜ì˜ êµìœ¡ ë°©ì‹ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì‹œë©´ ì´í•´í•˜ê¸° ì‰¬ì›Œìš”",
                        "ë¶€ëª¨ë‹˜ê³¼ ì„ ìƒë‹˜ì´ í˜‘ë ¥í•˜ëŠ” ëª¨ìŠµì„ ë³´ë©´ ì•ˆì‹¬ë¼ìš”",
                        "ì„ ìƒë‹˜ì´ ìš°ë¦¬ë¥¼ ìœ„í•´ ë…¸ë ¥í•˜ì‹ ë‹¤ëŠ” ê±¸ ë¶€ëª¨ë‹˜ë„ ì•Œë©´ ì¢‹ê² ì–´ìš”",
                        "ì„œë¡œ ë‹¤ë¥¸ ì˜ê²¬ë„ ì¡´ì¤‘í•˜ë©° ì†Œí†µí•˜ëŠ” ëª¨ìŠµì„ ë³´ê³  ì‹¶ì–´ìš”",
                        "í•™ìƒ ì¤‘ì‹¬ìœ¼ë¡œ ìƒê°í•´ì£¼ì‹œë©´ ê°ì‚¬í•´ìš”"
                    ],
                    actions: [
                        "êµìœ¡ ì² í•™ì´ë‚˜ ë°©ë²•ì„ í¸ì§€ë¡œ ì„¤ëª…í•˜ê¸°",
                        "í•™ìƒì˜ ì„±ì¥ ê³¼ì •ì„ ì‚¬ì§„ì´ë‚˜ ì˜ìƒìœ¼ë¡œ ê³µìœ í•˜ê¸°",
                        "í•™ë¶€ëª¨ ì°¸ì—¬ í™œë™ ê¸°íší•˜ê¸°",
                        "ì •ê¸°ì ì¸ ì†Œí†µ ì‹œê°„ ì •í•˜ê¸°",
                        "í•™ìƒì˜ ì¥ì ì„ ë¨¼ì € ì´ì•¼ê¸°í•˜ê¸°",
                        "íˆ¬ëª…í•œ êµìœ¡ê³¼ì • ê³µìœ í•˜ê¸°",
                        "í•™ë¶€ëª¨ ì˜ê²¬ì„ ìˆ˜ìš©í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ ì°¾ê¸°"
                    ]
                },
                'ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤': {
                    keywords: ['ì—…ë¬´', 'ì‹œê°„', 'ë¶€ì¡±', 'í”¼ê³¤', 'ë²ˆì•„ì›ƒ', 'í–‰ì •', 'ì¤€ë¹„', 'íšŒì˜', 'ë™ë£Œ', 'ê³¼ë¡œ', 'ì••ë°•', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'í˜ë“¤'],
                    weight: {
                        'ì—…ë¬´': 3, 'ìŠ¤íŠ¸ë ˆìŠ¤': 3, 'í”¼ê³¤': 3, 'ë²ˆì•„ì›ƒ': 3, 'ì‹œê°„': 2, 'ë¶€ì¡±': 2, 'í˜ë“¤': 2, 'ê³¼ë¡œ': 2, 'ì¤€ë¹„': 1
                    },
                    thinking: [
                        "ì„ ìƒë‹˜ì´ í˜ë“¤ì–´í•˜ì‹œë©´ ìš°ë¦¬ë„ ê±±ì •ë¼ìš”",
                        "ì„ ìƒë‹˜ë„ ì‰¬ëŠ” ì‹œê°„ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•´ìš”",
                        "ì„ ìƒë‹˜ì´ ì›ƒìœ¼ì‹œë©´ êµì‹¤ ë¶„ìœ„ê¸°ê°€ ì¢‹ì•„ì ¸ìš”",
                        "ìš°ë¦¬ê°€ ë„ìš¸ ìˆ˜ ìˆëŠ” ì¼ì´ ìˆìœ¼ë©´ ë§í•´ì£¼ì„¸ìš”",
                        "ì„ ìƒë‹˜ì˜ ê±´ê°•ì´ ê°€ì¥ ì¤‘ìš”í•´ìš”",
                        "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ìš°ë¦¬ëŠ” ì„ ìƒë‹˜ì„ ì¢‹ì•„í•´ìš”",
                        "ì„ ìƒë‹˜ì´ í–‰ë³µí•˜ì…”ì•¼ ìš°ë¦¬ë„ í–‰ë³µí•´ìš”"
                    ],
                    actions: [
                        "í•™ìƒë“¤ê³¼ ì—…ë¬´ ë¶„ë‹´í•˜ê¸° (ì²­ì†Œ, ì •ë¦¬ ë“±)",
                        "ê°„ë‹¨í•œ ì—…ë¬´ëŠ” í•™ìƒ ë„ìš°ë¯¸ í™œìš©í•˜ê¸°",
                        "ë™ë£Œ ì„ ìƒë‹˜ê³¼ í˜‘ë ¥ ì²´ê³„ ë§Œë“¤ê¸°",
                        "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ë§ˆìŒê°€ì§ ê°–ê¸°",
                        "íœ´ì‹ ì‹œê°„ í™•ë³´í•˜ê³  ìê¸° ëŒë´„í•˜ê¸°",
                        "ìš°ì„ ìˆœìœ„ë¥¼ ì •í•´ì„œ ì—…ë¬´ ê´€ë¦¬í•˜ê¸°",
                        "í•™êµ ê´€ë¦¬ìì—ê²Œ ì—…ë¬´ ë¶„ë‹´ ìš”ì²­í•˜ê¸°"
                    ]
                }
            },

            // ğŸ¯ ê³ ê¸‰ ë¶„ë¥˜ ì•Œê³ ë¦¬ì¦˜
            classify(text) {
                const normalizedText = text.toLowerCase().replace(/[^\w\s]/g, ' ');
                const words = normalizedText.split(/\s+/).filter(word => word.length > 0);
                
                const scores = {};
                const foundKeywords = {};
                
                // ê° ì¹´í…Œê³ ë¦¬ë³„ ì ìˆ˜ ê³„ì‚°
                Object.entries(this.categories).forEach(([category, data]) => {
                    scores[category] = 0;
                    foundKeywords[category] = [];
                    
                    words.forEach(word => {
                        if (data.keywords.includes(word)) {
                            const weight = data.weight[word] || 1;
                            scores[category] += weight;
                            foundKeywords[category].push(word);
                        }
                    });
                    
                    // í‚¤ì›Œë“œ ë°€ë„ ë³´ì •
                    if (foundKeywords[category].length > 0) {
                        scores[category] = scores[category] * (foundKeywords[category].length / words.length) * 100;
                    }
                });
                
                // ìµœê³  ì ìˆ˜ ì¹´í…Œê³ ë¦¬ ì°¾ê¸°
                let bestCategory = null;
                let maxScore = 0;
                
                Object.entries(scores).forEach(([category, score]) => {
                    if (score > maxScore) {
                        maxScore = score;
                        bestCategory = category;
                    }
                });
                
                // ì‹ ë¢°ë„ ê³„ì‚° (0-100%)
                const totalScore = Object.values(scores).reduce((sum, score) => sum + score, 0);
                const confidence = totalScore > 0 ? Math.min(Math.round((maxScore / totalScore) * 100), 95) : 0;
                
                return {
                    category: bestCategory || 'ìˆ˜ì—… ì°¸ì—¬',
                    confidence: Math.max(confidence, 30), // ìµœì†Œ 30% ë³´ì¥
                    scores: scores,
                    keywords: foundKeywords[bestCategory] || [],
                    allKeywords: foundKeywords
                };
            }
        };

        // ê°ì • ë°ì´í„°
        const emotions = [
            { name: "ì†ìƒí•¨", emoji: "ğŸ˜¢", empathy: "ì •ë§ ì†ìƒí•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ° ë§ˆìŒ ì¶©ë¶„íˆ ì´í•´í•´ìš”." },
            { name: "ê±±ì •ë¨", emoji: "ğŸ˜°", empathy: "ë§ì´ ê±±ì •ë˜ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ê³ ë¯¼ì„ í•˜ì‹œëŠ” ì„ ìƒë‹˜ì˜ ë§ˆìŒì´ ëŠê»´ì ¸ìš”." },
            { name: "ë‹µë‹µí•¨", emoji: "ğŸ˜¤", empathy: "ì •ë§ ë‹µë‹µí•˜ì…¨ì„ ê±°ì˜ˆìš”. ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ë§‰ë§‰í•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”." },
            { name: "ìŠ¤íŠ¸ë ˆìŠ¤", emoji: "ğŸ˜µ", empathy: "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë§ì´ ìŒ“ì´ì…¨ë‚˜ë´ìš”. í˜ë“œì…¨ì„ í…ë° ì´ë ‡ê²Œ ê³ ë¯¼í•´ì£¼ì…”ì„œ ê³ ë§ˆì›Œìš”." },
            { name: "ì‹¤ë§", emoji: "ğŸ˜", empathy: "ì‹¤ë§ìŠ¤ëŸ¬ìš°ì…¨ì„ ê±°ì˜ˆìš”. ê¸°ëŒ€í–ˆë˜ ê²ƒê³¼ ë‹¬ë¼ì„œ ë” ì†ìƒí•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”." },
            { name: "ë¶€ë‹´", emoji: "ğŸ˜“", empathy: "ë§ì€ ë¶€ë‹´ì„ ëŠë¼ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ë§ˆìŒ ì •ë§ ê³µê°í•´ìš”." },
            { name: "ë¯¸ì•ˆí•¨", emoji: "ğŸ˜”", empathy: "ë¯¸ì•ˆí•œ ë§ˆìŒì´ ë“œì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ë§ˆìŒì„ ê°€ì§€ì‹œëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¢‹ì€ ì„ ìƒë‹˜ì´ì„¸ìš”." },
            { name: "í”¼ê³¤í•¨", emoji: "ğŸ˜´", empathy: "ì •ë§ í”¼ê³¤í•˜ì…¨ì„ ê±°ì˜ˆìš”. ì‰¬ëŠ” ì‹œê°„ë„ ë¶€ì¡±í•˜ì‹¤ í…ë° ê³ ìƒì´ ë§ìœ¼ì„¸ìš”." }
        ];

        const encouragementMessages = [
            "ì„ ìƒë‹˜ì˜ ê³ ë¯¼í•˜ëŠ” ë§ˆìŒ ìì²´ê°€ í•™ìƒë“¤ì— ëŒ€í•œ ì‚¬ë‘ì´ì—ìš”! ğŸ’–",
            "ì™„ë²½í•œ ì„ ìƒë‹˜ì€ ì—†ì–´ìš”. ì§€ê¸ˆë„ ì¶©ë¶„íˆ ë©‹ì§„ ì„ ìƒë‹˜ì´ì„¸ìš”! â­",
            "í•™ìƒë“¤ì€ ì„ ìƒë‹˜ì´ ìƒê°í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ì„ ìƒë‹˜ì„ ì¢‹ì•„í•´ìš”! ğŸ˜Š",
            "ì‘ì€ ë³€í™”ë„ í° ì°¨ì´ë¥¼ ë§Œë“¤ì–´ìš”. í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”! ğŸŒ±",
            "ì„ ìƒë‹˜ì˜ ë…¸ë ¥í•˜ëŠ” ëª¨ìŠµì„ í•™ìƒë“¤ì´ ëª¨ë‘ ë³´ê³  ìˆì–´ìš”! ğŸ‘€",
            "í˜ë“¤ ë•ŒëŠ” ì‰¬ì–´ë„ ê´œì°®ì•„ìš”. ì„ ìƒë‹˜ì˜ ê±´ê°•ì´ ìš°ì„ ì´ì—ìš”! ğŸƒ",
            "í•™ìƒë“¤ì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”. ë¶„ëª… ì¢‹ì€ ì•„ì´ë””ì–´ë¥¼ ì¤„ ê±°ì˜ˆìš”! ğŸ’¡",
            "ì„ ìƒë‹˜ë§Œì˜ íŠ¹ë³„í•œ ë°©ë²•ì´ ìˆì„ ê±°ì˜ˆìš”. ìì‹ ê°ì„ ê°€ì§€ì„¸ìš”! ğŸ’ª",
            "ì‹¤ìˆ˜í•´ë„ ê´œì°®ì•„ìš”. ê·¸ê²ƒë„ ìš°ë¦¬ì—ê²ŒëŠ” ì¢‹ì€ ë°°ì›€ì´ì—ìš”! ğŸ“š",
            "ì„ ìƒë‹˜ì´ ìˆì–´ì„œ ìš°ë¦¬ êµì‹¤ì´ ë”°ëœ»í•´ìš”. ê°ì‚¬í•´ìš”! ğŸ "
        ];

        // ğŸ” ì‹¤ì‹œê°„ ê³ ë¯¼ ë¶„ì„ í•¨ìˆ˜
        function analyzeWorryInput() {
            const worryText = document.getElementById('worryInput').value.trim();
            const nextBtn = document.getElementById('step2Next');
            const resultDiv = document.getElementById('smartAnalysisResult');
            
            if (worryText.length >= 10) {
                // ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ì‹¤í–‰
                const analysis = advancedClassificationSystem.classify(worryText);
                
                // ë¶„ì„ ê²°ê³¼ ì €ì¥
                selectedWorry = {
                    text: worryText,
                    category: analysis.category,
                    confidence: analysis.confidence,
                    keywords: analysis.keywords,
                    isCustom: true
                };
                detectedCategory = analysis.category;
                analysisConfidence = analysis.confidence;
                detectedKeywords = analysis.keywords;
                
                // ê²°ê³¼ í‘œì‹œ
                displayAnalysisResult(analysis);
                resultDiv.classList.remove('hidden');
                
                // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
                nextBtn.disabled = false;
                
                // ë§ì¶¤í˜• ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¯¸ë¦¬ ë¡œë“œ
                loadCustomizedChecklists(analysis.category);
                
            } else {
                resultDiv.classList.add('hidden');
                nextBtn.disabled = true;
                selectedWorry = null;
            }
        }

        // ğŸ“Š ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayAnalysisResult(analysis) {
            // ì¹´í…Œê³ ë¦¬ ë°°ì§€
            const categoryBadge = document.getElementById('detectedCategoryBadge');
            categoryBadge.className = `category-badge category-${analysis.category.replace(' ', '')}`;
            categoryBadge.textContent = `${getCategoryIcon(analysis.category)} ${analysis.category}`;
            
            // ì‹ ë¢°ë„ í‘œì‹œ
            const confidenceBar = document.getElementById('confidenceLevel');
            const confidenceText = document.getElementById('confidenceText');
            confidenceBar.style.width = `${analysis.confidence}%`;
            confidenceText.textContent = `${analysis.confidence}% ì •í™•ë„`;
            
            // í‚¤ì›Œë“œ í‘œì‹œ
            const keywordsDiv = document.getElementById('detectedKeywords');
            keywordsDiv.innerHTML = analysis.keywords.map(keyword => 
                `<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">${keyword}</span>`
            ).join(' ');
            
            // ë¶„ì„ ì¸ì‚¬ì´íŠ¸
            const insightDiv = document.getElementById('analysisInsight');
            insightDiv.textContent = getAnalysisInsight(analysis);
        }

        // ğŸ“ ë§ì¶¤í˜• ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
        function loadCustomizedChecklists(category) {
            const categoryData = advancedClassificationSystem.categories[category];
            if (!categoryData) return;
            
            // ìƒê° ì²´í¬ë¦¬ìŠ¤íŠ¸
            const thinkingContainer = document.getElementById('customThinkingChecklist');
            thinkingContainer.innerHTML = categoryData.thinking.map((item, index) => `
                <div class="checklist-item" onclick="toggleChecklistItem(this, 'thinking')">
                    <input type="checkbox" id="thinking-${index}" class="thinking-checkbox">
                    <label for="thinking-${index}">${item}</label>
                </div>
            `).join('');
            
            // í–‰ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸
            const actionContainer = document.getElementById('customActionChecklist');
            actionContainer.innerHTML = categoryData.actions.map((item, index) => `
                <div class="checklist-item" onclick="toggleChecklistItem(this, 'action')">
                    <input type="checkbox" id="action-${index}" class="action-checkbox">
                    <label for="action-${index}">${item}</label>
                </div>
            `).join('');
        }

        // âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ í† ê¸€
        function toggleChecklistItem(itemDiv, type) {
            const checkbox = itemDiv.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                itemDiv.classList.add('selected');
            } else {
                itemDiv.classList.remove('selected');
            }
            
            updateChecklistCounts();
            updateRealtimeAdvicePreview();
        }

        // ğŸ“Š ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„ íƒ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateChecklistCounts() {
            const thinkingChecked = document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked').length;
            const actionChecked = document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked').length;
            
            document.getElementById('thinkingCount').textContent = `${thinkingChecked}ê°œ ì„ íƒ`;
            document.getElementById('actionCount').textContent = `${actionChecked}ê°œ ì„ íƒ`;
        }

        // ğŸ¯ ì„ íƒëœ ê³ ë¯¼ ì§€ì† í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSelectedWorryDisplay() {
            if (selectedWorry && currentStep >= 3 && currentStep < 7) {
                const worryCard = document.getElementById('selectedWorryCard');
                const worryText = document.getElementById('selectedWorryText');
                const worryCategory = document.getElementById('selectedWorryCategory');
                const smartBadge = document.getElementById('smartClassificationBadge');
                
                worryText.textContent = selectedWorry.text;
                worryCategory.className = `category-badge category-${selectedWorry.category.replace(' ', '')}`;
                worryCategory.textContent = `${getCategoryIcon(selectedWorry.category)} ${selectedWorry.category}`;
                
                if (selectedWorry.isCustom) {
                    smartBadge.classList.remove('hidden');
                }
                
                worryCard.classList.remove('hidden');
            } else {
                // 7ë‹¨ê³„ì—ì„œëŠ” ê³ ë¯¼ í‘œì‹œ ì¹´ë“œë„ ìˆ¨ê¸°ê¸°
                document.getElementById('selectedWorryCard').classList.add('hidden');
            }
        }

        // ğŸ”„ ì‹¤ì‹œê°„ ì¡°ì–¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateRealtimeAdvicePreview() {
            const thinkingChecked = Array.from(document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            const actionChecked = Array.from(document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (thinkingChecked.length > 0 || actionChecked.length > 0) {
                let previewHTML = '';
                
                if (thinkingChecked.length > 0) {
                    previewHTML += '<h4 class="font-semibold mb-2 text-purple-700">ğŸ’­ ìƒê°í•´ë³¼ ì :</h4>';
                    previewHTML += `<p class="mb-4">${thinkingChecked.join('. ')}.</p>`;
                }
                
                if (actionChecked.length > 0) {
                    previewHTML += '<h4 class="font-semibold mb-2 text-cyan-700">ğŸ¯ ì‹œë„í•´ë³¼ ë°©ë²•:</h4>';
                    previewHTML += '<ul class="list-disc list-inside">';
                    actionChecked.forEach(action => {
                        previewHTML += `<li>${action}</li>`;
                    });
                    previewHTML += '</ul>';
                }
                
                document.getElementById('advicePreviewContent').innerHTML = previewHTML;
                document.getElementById('realtimeAdvicePreview').classList.remove('hidden');
            } else {
                document.getElementById('realtimeAdvicePreview').classList.add('hidden');
            }
        }

        // ğŸ“ ìƒê° ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ìš©
        function applyThinkingChecklist() {
            const checkedItems = Array.from(document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (checkedItems.length > 0) {
                const textarea = document.getElementById('thinking-textarea');
                const currentText = textarea.value;
                const newText = checkedItems.join('. ') + '.';
                
                if (currentText.trim()) {
                    textarea.value = currentText + '\n\n' + newText;
                } else {
                    textarea.value = newText;
                }
                
                // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.checklist-item').classList.remove('selected');
                });
                
                updateChecklistCounts();
                updateRealtimeAdvicePreview();
                showNotification('ğŸ’­ ì„ íƒí•œ ìƒê°ë“¤ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                showNotification('â— ì ìš©í•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
            }
        }

        // ğŸ¯ í–‰ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ìš©
        function applyActionChecklist() {
            const checkedItems = Array.from(document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (checkedItems.length > 0) {
                const textarea = document.getElementById('action-textarea');
                const currentText = textarea.value;
                const newText = checkedItems.map((item, index) => `${index + 1}) ${item}`).join('\n');
                
                if (currentText.trim()) {
                    textarea.value = currentText + '\n\n' + newText;
                } else {
                    textarea.value = newText;
                }
                
                // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                document.querySelectorAll('#customActionChecklist input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.checklist-item').classList.remove('selected');
                });
                
                updateChecklistCounts();
                updateRealtimeAdvicePreview();
                showNotification('ğŸ¯ ì„ íƒí•œ ë°©ë²•ë“¤ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                showNotification('â— ì ìš©í•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
            }
        }

        // ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ ë°˜í™˜
        function getCategoryIcon(category) {
            const icons = {
                'ìˆ˜ì—… ì°¸ì—¬': 'ğŸ“š',
                'í•™ê¸‰ ê´€ë¦¬': 'ğŸ‘¥', 
                'í•™ìŠµ ì§€ë„': 'ğŸ“–',
                'í•™ë¶€ëª¨ ê´€ê³„': 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
                'ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤': 'ğŸ’¼'
            };
            return icons[category] || 'ğŸ“';
        }

        // ğŸ’¡ ë¶„ì„ ì¸ì‚¬ì´íŠ¸ ìƒì„±
        function getAnalysisInsight(analysis) {
            const insights = {
                'ìˆ˜ì—… ì°¸ì—¬': `ìˆ˜ì—… ì°¸ì—¬ë„ ê´€ë ¨ ê³ ë¯¼ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. í•™ìƒ ì°¸ì—¬ë¥¼ ë†’ì´ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì„ ì¤€ë¹„í–ˆì–´ìš”!`,
                'í•™ê¸‰ ê´€ë¦¬': `í•™ê¸‰ ê´€ë¦¬ ê´€ë ¨ ê³ ë¯¼ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. ê¸ì •ì ì¸ í•™ê¸‰ ë¶„ìœ„ê¸° ì¡°ì„± ë°©ë²•ì„ ì œì•ˆí•´ë“œë¦´ê²Œìš”!`,
                'í•™ìŠµ ì§€ë„': `í•™ìŠµ ì§€ë„ ê´€ë ¨ ê³ ë¯¼ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. ê°œë³„ ë§ì¶¤ í•™ìŠµ ì§€ì› ë°©ì•ˆì„ ì¤€ë¹„í–ˆì–´ìš”!`,
                'í•™ë¶€ëª¨ ê´€ê³„': `í•™ë¶€ëª¨ ê´€ê³„ ê´€ë ¨ ê³ ë¯¼ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. íš¨ê³¼ì ì¸ ì†Œí†µ ë°©ë²•ë“¤ì„ ì•Œë ¤ë“œë¦´ê²Œìš”!`,
                'ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤': `ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë ¨ ê³ ë¯¼ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤. ì—…ë¬´ íš¨ìœ¨ì„±ê³¼ ìê¸° ëŒë´„ ë°©ë²•ì„ ì œì•ˆí•´ë“œë¦´ê²Œìš”!`
            };
            return insights[analysis.category] || 'ë¶„ì„ ê²°ê³¼ì— ë”°ë¥¸ ë§ì¶¤í˜• ì¡°ì–¸ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤!';
        }

        // ê°ì • ë²„íŠ¼ ë Œë”ë§
        function renderEmotionButtons() {
            const container = document.getElementById('emotionButtons');
            container.innerHTML = '';
            
            emotions.forEach(emotion => {
                const button = document.createElement('button');
                button.className = 'bg-white border-2 border-gray-200 rounded-lg p-4 text-center hover:border-green-400 transition-all duration-200';
                button.onclick = () => selectEmotion(emotion);
                button.innerHTML = `
                    <div class="text-3xl mb-2">${emotion.emoji}</div>
                    <div class="font-medium">${emotion.name}</div>
                `;
                container.appendChild(button);
            });
        }

        // ê°ì • ì„ íƒ
        function selectEmotion(emotion) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('#emotionButtons button').forEach(btn => {
                btn.classList.remove('border-green-400', 'bg-green-50');
                btn.classList.add('border-gray-200');
            });
            
            // ìƒˆ ì„ íƒ í‘œì‹œ
            event.target.closest('button').classList.remove('border-gray-200');
            event.target.closest('button').classList.add('border-green-400', 'bg-green-50');
            
            selectedEmotion = emotion;
            
            // ê³µê° ë©”ì‹œì§€ í‘œì‹œ
            document.getElementById('empathyText').textContent = emotion.empathy;
            document.getElementById('empathyMessage').classList.remove('hidden');
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('step4Next').disabled = false;
            
            showNotification('ğŸ’š ê°ì •ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ê²©ë ¤ ë©”ì‹œì§€ ë½‘ê¸°
        function drawEncouragementMessage() {
            const randomIndex = Math.floor(Math.random() * encouragementMessages.length);
            const message = encouragementMessages[randomIndex];
            
            document.getElementById('encouragementText').textContent = message;
            document.getElementById('encouragementCard').classList.remove('hidden');
            
            showNotification('ğŸ’Œ ë”°ëœ»í•œ ê²©ë ¤ ë©”ì‹œì§€ê°€ ë„ì°©í–ˆì–´ìš”!');
        }

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ë‹¨ê³„ ì´ë™ í•¨ìˆ˜
        function goToStep(targetStep) {
            // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            // íƒ€ê²Ÿ ë‹¨ê³„ ë³´ì´ê¸°
            document.getElementById(`step${targetStep}`).classList.remove('hidden');
            document.getElementById(`step${targetStep}`).classList.add('active');
            document.getElementById(`step${targetStep}`).scrollIntoView({ behavior: 'smooth' });
            
            // 7ë‹¨ê³„ì¼ ë•Œ ë„¤ë¹„ê²Œì´ì…˜ê³¼ í—¤ë” ìˆ¨ê¸°ê¸°
            const stepNav = document.getElementById('stepNavigation');
            const headerDiv = document.querySelector('.text-center.mb-8');
            
            if (targetStep === 7) {
                stepNav.classList.add('hidden-final');
                headerDiv.classList.add('hidden');
                // ì „ì²´ ì»¨í…Œì´ë„ˆë¥¼ ìµœì¢… ê²°ê³¼ ìŠ¤íƒ€ì¼ë¡œ ë³€ê²½
                document.body.className = 'final-result-container';
            } else {
                stepNav.classList.remove('hidden-final');
                headerDiv.classList.remove('hidden');
                document.body.className = 'bg-gray-50 min-h-screen';
            }
            
            // ë‹¨ê³„ ë²„íŠ¼ ì—…ë°ì´íŠ¸ (7ë‹¨ê³„ê°€ ì•„ë‹ ë•Œë§Œ)
            if (targetStep !== 7) {
                document.querySelectorAll('.step-btn').forEach((btn, index) => {
                    const btnStep = index + 1;
                    btn.classList.remove('active');
                    
                    if (btnStep === targetStep) {
                        btn.classList.add('active');
                    }
                    
                    if (btnStep < targetStep) {
                        btn.classList.remove('disabled');
                        btn.classList.add('completed');
                    } else if (btnStep > targetStep) {
                        btn.classList.add('disabled');
                        btn.classList.remove('completed');
                    }
                });
            }
            
            currentStep = targetStep;
            
            // ì„ íƒëœ ê³ ë¯¼ ì§€ì† í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSelectedWorryDisplay();
            
            // 5ë‹¨ê³„ì—ì„œ ë§ì¶¤í˜• ì¡°ì–¸ ì•ˆë‚´ ì—…ë°ì´íŠ¸
            if (targetStep === 5 && selectedWorry) {
                updateAdviceIntro();
            }
            
            if (targetStep !== 7) {
                showNotification(`ğŸ“ ${targetStep}ë‹¨ê³„ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤!`);
            }
        }

        // 5ë‹¨ê³„ ë§ì¶¤í˜• ì¡°ì–¸ ì•ˆë‚´ ì—…ë°ì´íŠ¸
        function updateAdviceIntro() {
            if (selectedWorry) {
                const introText = document.getElementById('adviceIntroText');
                introText.textContent = `"${selectedWorry.category}" ë¶„ì•¼ì˜ ê³ ë¯¼ì— íŠ¹í™”ëœ ì¡°ì–¸ë“¤ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤! ê°€ì¥ ë„ì›€ì´ ë  ê²ƒ ê°™ì€ í•­ëª©ë“¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`;
            }
        }

        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
        function nextStep(step) {
            // ìœ íš¨ì„± ê²€ì‚¬
            if (step === 1) {
                const studentName = document.getElementById('studentName').value.trim();
                const teacherName = document.getElementById('teacherName').value.trim();
                if (!studentName || !teacherName) {
                    showNotification('â— í•™ìƒ ì´ë¦„ê³¼ ì„ ìƒë‹˜ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            if (step === 2) {
                if (!selectedWorry) {
                    showNotification('â— ê³ ë¯¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ABC í•„ë“œ ì´ˆê¸° ì„¤ì •
                if (selectedWorry.isCustom) {
                    document.getElementById('factA').value = selectedWorry.text;
                    document.getElementById('beliefB').value = '';
                    document.getElementById('consequenceC').value = '';
                }
            }
            
            if (step === 6) {
                generateFinalResult();
                goToStep(7);
                return;
            }
            
            goToStep(step + 1);
        }

        // ì´ì „ ë‹¨ê³„ë¡œ ì´ë™
        function prevStep(step) {
            goToStep(step - 1);
        }

        // ìµœì¢… ê²°ê³¼ ìƒì„±
        function generateFinalResult() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const personalMessage = document.getElementById('personalMessage').value;
            
            let resultHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">ğŸŒŸ ${studentName}ì˜ ë§ì¶¤í˜• ìƒë‹´ ê²°ê³¼</h3>
                    <p class="text-lg text-gray-600">${teacherName}ì„ ìœ„í•œ ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê¸°ë°˜ ì¡°ì–¸</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">ğŸ¯ ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê²°ê³¼</h4>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <span class="category-badge category-${selectedWorry.category.replace(' ', '')}">${getCategoryIcon(selectedWorry.category)} ${selectedWorry.category}</span>
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">ğŸ¤– ${selectedWorry.confidence}% ì •í™•ë„</span>
                            </div>
                            <p class="text-sm text-gray-600">ê°ì§€ëœ í‚¤ì›Œë“œ: ${detectedKeywords.join(', ')}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">ğŸ’– ì„ íƒí•œ ê°ì •</h4>
                        <p class="text-gray-600">${selectedEmotion?.emoji} ${selectedEmotion?.name}</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">ğŸ“ ê³ ë¯¼ ìƒí™©</h4>
                    <p class="text-gray-600">${selectedWorry?.text}</p>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">ğŸ¯ ë§ì¶¤í˜• ì¡°ì–¸</h4>
                    ${document.getElementById('advicePreviewContent').innerHTML || '<p class="text-gray-500">ì‘ì„±ëœ ì¡°ì–¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
            `;
            
            if (document.getElementById('encouragementText').textContent) {
                resultHTML += `
                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200 mt-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">ğŸ’Œ ê²©ë ¤ ë©”ì‹œì§€</h4>
                        <p class="text-gray-700">${document.getElementById('encouragementText').textContent}</p>
                    </div>
                `;
            }
            
            if (personalMessage) {
                resultHTML += `
                    <div class="bg-pink-50 rounded-lg p-4 border border-pink-200 mt-4">
                        <h4 class="font-semibold text-pink-800 mb-2">âœï¸ ê°œì¸ ë©”ì‹œì§€</h4>
                        <p class="text-gray-700">${personalMessage}</p>
                    </div>
                `;
            }
            
            document.getElementById('finalResult').innerHTML = resultHTML;
        }

        // í…ìŠ¤íŠ¸ë¡œ ì €ì¥
        function saveAsText() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const date = new Date().toLocaleDateString('ko-KR');
            
            let content = `ABC ê³ ê¸‰ ìŠ¤ë§ˆíŠ¸ ìƒë‹´ ê²°ê³¼\n`;
            content += `ìƒë‹´ì¼: ${date}\n`;
            content += `ìƒë‹´ í•™ìƒ: ${studentName}\n`;
            content += `ìƒë‹´ ëŒ€ìƒ: ${teacherName}\n\n`;
            
            content += `[ìŠ¤ë§ˆíŠ¸ ë¶„ì„ ê²°ê³¼]\n`;
            content += `ë¶„ë¥˜: ${selectedWorry.category} (${selectedWorry.confidence}% ì •í™•ë„)\n`;
            content += `í‚¤ì›Œë“œ: ${detectedKeywords.join(', ')}\n\n`;
            
            content += `[ê³ ë¯¼ ìƒí™©]\n${selectedWorry?.text}\n\n`;
            
            content += `[ABC ë¶„ì„]\n`;
            content += `A (ì‚¬ì‹¤): ${document.getElementById('factA').value}\n`;
            content += `B (ìƒê°): ${document.getElementById('beliefB').value}\n`;
            content += `C (ê²°ê³¼): ${document.getElementById('consequenceC').value}\n\n`;
            
            content += `[ê°ì •]: ${selectedEmotion?.name}\n\n`;
            
            // ì¡°ì–¸ ë‚´ìš© ì¶”ê°€
            const thinkingText = document.getElementById('thinking-textarea')?.value;
            const actionText = document.getElementById('action-textarea')?.value;
            
            if (thinkingText || actionText) {
                content += `[ë§ì¶¤í˜• ì¡°ì–¸]\n`;
                if (thinkingText) {
                    content += `ìƒê°í•´ë³¼ ì :\n${thinkingText}\n\n`;
                }
                if (actionText) {
                    content += `ì‹œë„í•´ë³¼ ë°©ë²•:\n${actionText}\n\n`;
                }
            }
            
            const encouragement = document.getElementById('encouragementText').textContent;
            if (encouragement) {
                content += `[ê²©ë ¤ ë©”ì‹œì§€]\n${encouragement}\n\n`;
            }
            
            const personalMessage = document.getElementById('personalMessage').value;
            if (personalMessage) {
                content += `[ê°œì¸ ë©”ì‹œì§€]\n${personalMessage}\n\n`;
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ABCìŠ¤ë§ˆíŠ¸ìƒë‹´_${studentName}_${date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('ğŸ“„ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì¸ì‡„
        function printResult() {
            window.print();
        }

        // í¼ ë¦¬ì…‹
        function resetForm() {
            if (confirm('ì •ë§ ìƒˆë¡œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.')) {
                location.reload();
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            renderEmotionButtons();
            
            // ë‹¨ê³„ ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.querySelectorAll('.step-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const step = parseInt(this.dataset.step);
                    if (!this.classList.contains('disabled')) {
                        goToStep(step);
                    }
                });
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>