<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC 교사 상담 도구 - 완전한 카테고리 우선 버전</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        /* 카테고리 선택 카드 */
        .category-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }

        .category-card.selected {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }

        .category-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            transition: width 0.3s ease;
        }

        .category-card.selected::before {
            width: 8px;
        }

        /* 카테고리별 색상 */
        .category-수업참여::before { background: linear-gradient(180deg, #22c55e, #16a34a); }
        .category-학급관리::before { background: linear-gradient(180deg, #3b82f6, #2563eb); }
        .category-학습지도::before { background: linear-gradient(180deg, #8b5cf6, #7c3aed); }
        .category-학부모관계::before { background: linear-gradient(180deg, #f97316, #ea580c); }
        .category-업무스트레스::before { background: linear-gradient(180deg, #ef4444, #dc2626); }

        /* 예시 상황 카드 */
        .situation-example {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
        }

        .situation-example:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #6366f1;
        }

        .situation-example.selected {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #0ea5e9;
        }

        /* 카테고리별 배지 색상 */
        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }

        .category-수업참여 { background: #dcfce7; color: #166534; }
        .category-학급관리 { background: #dbeafe; color: #1e40af; }
        .category-학습지도 { background: #ede9fe; color: #5b21b6; }
        .category-학부모관계 { background: #fed7aa; color: #9a3412; }
        .category-업무스트레스 { background: #fecaca; color: #991b1b; }

        /* 향상된 체크리스트 스타일 */
        .enhanced-checklist {
            background: rgba(139, 92, 246, 0.03);
            border: 2px solid rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .enhanced-checklist:hover {
            border-color: rgba(139, 92, 246, 0.2);
            background: rgba(139, 92, 246, 0.05);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .checklist-item:hover {
            background: rgba(139, 92, 246, 0.05);
            border-color: rgba(139, 92, 246, 0.1);
        }

        .checklist-item.selected {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .checklist-item input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .checklist-item label {
            flex: 1;
            cursor: pointer;
            line-height: 1.5;
            color: #4b5563;
            font-size: 0.95rem;
        }

        /* 선택된 고민 지속 표시 */
        .selected-worry-display {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border: 2px solid #f97316;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            animation: slideDown 0.5s ease;
            position: sticky;
            top: 10px;
            z-index: 10;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* 실시간 조언 생성 */
        .realtime-advice {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 단계별 네비게이션 */
        .step-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* 7단계에서 네비게이션 숨기기 */
        .step-nav.hidden-final {
            display: none;
        }
        
        .step-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 8px;
            text-align: center;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 0.85rem;
            position: relative;
            overflow: hidden;
        }
        
        .step-btn.active {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .step-btn.completed {
            opacity: 0.9;
        }
        
        .step-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .step1-btn { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .step1-btn.active { border-color: #059669; }
        
        .step2-btn { background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); color: #1e40af; }
        .step2-btn.active { border-color: #3b82f6; }
        
        .step3-btn { background: linear-gradient(135deg, #ede9fe 0%, #c4b5fd 100%); color: #5b21b6; }
        .step3-btn.active { border-color: #8b5cf6; }
        
        .step4-btn { background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%); color: #9a3412; }
        .step4-btn.active { border-color: #f97316; }
        
        .step5-btn { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; }
        .step5-btn.active { border-color: #f59e0b; }
        
        .step6-btn { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); color: #6b21a8; }
        .step6-btn.active { border-color: #8b5cf6; }

        .step-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .step-card.active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        /* 감정 버튼 스타일 */
        .emotion-btn {
            transition: all 0.2s ease;
        }
        
        .emotion-btn:hover {
            transform: translateY(-2px);
        }
        
        .emotion-btn.selected {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        /* 최종 결과 화면 전용 스타일 */
        .final-result-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .final-result-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* 격려 메시지 카드 */
        .message-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }

        /* 알림 시스템 */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .step-nav {
                flex-direction: column;
                gap: 4px;
            }
            
            .step-btn {
                font-size: 0.8rem;
                padding: 10px 8px;
                min-width: auto;
            }

            .enhanced-checklist {
                padding: 16px;
            }

            .checklist-item {
                padding: 10px;
            }

            .final-result-container {
                padding: 1rem 0;
            }
        }

        /* 인쇄시 네비게이션 숨기기 */
        @media print {
            .step-nav {
                display: none !important;
            }
            .selected-worry-display {
                position: static;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">🧠 ABC 교사 상담 도구</h1>
            <p class="text-lg text-gray-600">카테고리 우선 선택 & 맞춤형 조언 시스템</p>
            <div class="mt-3 text-sm bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 inline-block px-4 py-2 rounded-full border border-blue-200">
                ✨ 📂 카테고리 선택 + 🤖 맞춤형 예시 + 📝 스마트 체크리스트
            </div>
        </div>

        <!-- 단계별 네비게이션 -->
        <nav class="step-nav" id="stepNavigation">
            <button class="step-btn step1-btn active" data-step="1">
                1️⃣ 기본정보<br>
                <span class="text-xs opacity-75">이름 입력</span>
            </button>
            <button class="step-btn step2-btn disabled" data-step="2">
                2️⃣ 고민분야<br>
                <span class="text-xs opacity-75">📂 카테고리 선택</span>
            </button>
            <button class="step-btn step3-btn disabled" data-step="3">
                3️⃣ ABC정리<br>
                <span class="text-xs opacity-75">구조적 분석</span>
            </button>
            <button class="step-btn step4-btn disabled" data-step="4">
                4️⃣ 감정공감<br>
                <span class="text-xs opacity-75">마음 이해</span>
            </button>
            <button class="step-btn step5-btn disabled" data-step="5">
                5️⃣ 맞춤조언<br>
                <span class="text-xs opacity-75">📝 스마트 체크리스트</span>
            </button>
            <button class="step-btn step6-btn disabled" data-step="6">
                6️⃣ 격려완성<br>
                <span class="text-xs opacity-75">응원 메시지</span>
            </button>
        </nav>

        <!-- 선택된 고민 지속 표시 (3단계부터) -->
        <div id="selectedWorryCard" class="selected-worry-display hidden">
            <div class="flex items-start gap-3">
                <div class="text-2xl">🎯</div>
                <div class="flex-1">
                    <h3 class="font-semibold text-orange-800 mb-2">선택된 고민</h3>
                    <p id="selectedWorryText" class="text-gray-700 mb-2"></p>
                    <div class="flex items-center gap-2">
                        <span id="selectedWorryCategory" class="category-badge"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 단계 1: 기본 정보 입력 -->
        <div class="step-card active border-2 rounded-lg p-6 mb-6" id="step1">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">1️⃣ 기본 정보를 입력해주세요</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👦 상담하는 학생 이름</label>
                    <input type="text" id="studentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="김민수">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">👩‍🏫 상담받는 선생님 이름</label>
                    <input type="text" id="teacherName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="이영희 선생님">
                </div>
            </div>
            <div class="mt-6 text-right">
                <button onclick="nextStep(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 2: 고민 분야 선택 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step2">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">2️⃣ 고민 분야를 선택해주세요</h2>
            
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6">
                <h3 class="font-semibold text-blue-800 mb-3">📂 카테고리 우선 선택 시스템</h3>
                <p class="text-sm text-gray-600 mb-3">
                    먼저 고민 분야를 선택하시면, 해당 분야의 구체적인 상황 예시들을 보여드립니다!
                </p>
            </div>

            <!-- 카테고리 선택 -->
            <div id="categorySelection">
                <h3 class="text-lg font-medium mb-4 text-gray-700">고민 분야를 선택해주세요</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="categoryCards">
                    <!-- 카테고리 카드들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 구체적 상황 선택 -->
            <div id="situationSelection" class="hidden">
                <div class="flex items-center mb-4">
                    <button onclick="backToCategories()" class="text-blue-500 hover:text-blue-600 mr-3">← 분야 다시 선택</button>
                    <h3 class="text-lg font-medium text-gray-700" id="selectedCategoryTitle"></h3>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-yellow-800 mb-2">💡 맞춤형 상황 예시</h4>
                    <p class="text-sm text-gray-600">아래 예시 중에서 선택하거나, 직접 입력해주세요!</p>
                </div>

                <div class="grid gap-3 mb-6" id="situationExamples">
                    <!-- 구체적 상황 예시들이 여기에 동적으로 추가됩니다 -->
                </div>
                
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium text-gray-800 mb-2">✏️ 또는 직접 입력하기</h4>
                    <textarea id="customWorry" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3" placeholder="이 분야에서 다른 고민이 있다면 여기에 적어주세요..." oninput="checkCustomWorryInput()"></textarea>
                </div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(2)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(2)" id="step2Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 3: ABC 정리 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step3">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">3️⃣ ABC로 상황을 정리해보아요</h2>
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h3 class="font-semibold text-red-700 mb-2">🅰️ 사실 (Facts)</h3>
                    <p class="text-sm text-gray-600 mb-2">실제로 일어난 일</p>
                    <textarea id="factA" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="font-semibold text-yellow-700 mb-2">🅱️ 생각 (Beliefs)</h3>
                    <p class="text-sm text-gray-600 mb-2">그때 든 생각이나 믿음</p>
                    <textarea id="beliefB" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" rows="3"></textarea>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-700 mb-2">🅲️ 결과 (Consequences)</h3>
                    <p class="text-sm text-gray-600 mb-2">그래서 나타난 감정이나 행동</p>
                    <textarea id="consequenceC" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3"></textarea>
                </div>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(3)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(3)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 4: 감정 공감 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step4">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">4️⃣ 선생님의 감정에 공감해주세요</h2>
            <p class="text-gray-600 mb-6">선생님이 지금 어떤 기분이실까요? 가장 가까운 감정을 선택해주세요.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6" id="emotionButtons">
                <!-- 감정 버튼들이 여기에 동적으로 추가됩니다 -->
            </div>
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 hidden" id="empathyMessage">
                <h3 class="font-medium text-green-700 mb-2">💚 공감 메시지</h3>
                <p id="empathyText" class="text-gray-700"></p>
            </div>
            <div class="flex justify-between">
                <button onclick="prevStep(4)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(4)" id="step4Next" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" disabled>다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 5: 맞춤형 조언 체크리스트 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step5">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">5️⃣ 맞춤 조언을 선택해주세요</h2>
            
            <!-- 분류 결과 기반 안내 -->
            <div id="customizedAdviceIntro" class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4 mb-6">
                <h3 class="font-semibold text-purple-800 mb-2">🎯 맞춤형 조언 체크리스트</h3>
                <p class="text-sm text-gray-600" id="adviceIntroText">
                    선택하신 고민 분야에 따라 가장 효과적인 조언들을 준비했습니다!
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <!-- 생각해볼 점 -->
                <div class="enhanced-checklist">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="text-lg font-semibold text-purple-700">🤔 생각해볼 점</h3>
                            <span id="thinkingCount" class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full">0개 선택</span>
                        </div>
                        <button onclick="applyThinkingChecklist()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            📝 적용하기
                        </button>
                    </div>
                    <div id="customThinkingChecklist" class="space-y-1 mb-4">
                        <!-- 맞춤형 생각 체크리스트가 여기에 동적으로 추가됩니다 -->
                    </div>
                    <textarea id="thinking-textarea" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="4" placeholder="선택한 생각들이 여기에 추가됩니다..."></textarea>
                </div>
                
                <!-- 행동 아이디어 -->
                <div class="enhanced-checklist">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="text-lg font-semibold text-cyan-700">🎯 행동 아이디어</h3>
                            <span id="actionCount" class="text-xs bg-cyan-100 text-cyan-600 px-2 py-1 rounded-full">0개 선택</span>
                        </div>
                        <button onclick="applyActionChecklist()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            🎯 적용하기
                        </button>
                    </div>
                    <div id="customActionChecklist" class="space-y-1 mb-4">
                        <!-- 맞춤형 행동 체크리스트가 여기에 동적으로 추가됩니다 -->
                    </div>
                    <textarea id="action-textarea" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent" rows="4" placeholder="선택한 방법들이 여기에 추가됩니다..."></textarea>
                </div>
            </div>

            <!-- 실시간 조언 미리보기 -->
            <div id="realtimeAdvicePreview" class="hidden realtime-advice">
                <h3 class="font-semibold text-green-700 mb-3">✨ 생성된 조언 미리보기</h3>
                <div id="advicePreviewContent" class="text-gray-700"></div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(5)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">다음 단계 →</button>
            </div>
        </div>

        <!-- 단계 6: 격려 메시지 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">6️⃣ 격려 메시지를 전해주세요</h2>
            
            <div class="text-center mb-6">
                <button onclick="drawEncouragementMessage()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-lg font-medium text-lg transition-colors">
                    🎯 격려 메시지 뽑기
                </button>
            </div>

            <div class="message-card rounded-lg p-6 mb-6 hidden" id="encouragementCard">
                <h3 class="font-semibold text-yellow-800 mb-3 text-center">💌 뽑힌 격려 메시지</h3>
                <p id="encouragementText" class="text-gray-800 text-center text-lg font-medium"></p>
            </div>

            <div class="bg-pink-50 border border-pink-200 rounded-lg p-4 mb-6">
                <h3 class="font-medium text-pink-700 mb-2">✏️ 개인적인 메시지 추가</h3>
                <textarea id="personalMessage" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent" rows="3" placeholder="선생님께 전하고 싶은 개인적인 응원 메시지를 적어주세요..."></textarea>
            </div>

            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6">
                <h3 class="font-medium text-indigo-700 mb-3">🤝 실천 약속</h3>
                <div class="grid md:grid-cols-2 gap-2" id="commitmentOptions">
                    <!-- 실천 약속 옵션들이 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <div class="flex justify-between">
                <button onclick="prevStep(6)" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">← 이전</button>
                <button onclick="nextStep(6)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">완성하기 🎉</button>
            </div>
        </div>

        <!-- 단계 7: 결과 확인 및 저장 -->
        <div class="step-card border-2 rounded-lg p-6 mb-6 hidden" id="step7">
            <!-- 최종 결과 화면에는 네비게이션이 숨겨지고 깔끔한 결과만 표시 -->
            <div class="final-result-card">
                <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">🎉 상담이 완료되었습니다!</h2>
                
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6 mb-6" id="finalResult">
                    <!-- 최종 결과가 여기에 표시됩니다 -->
                </div>

                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <button onclick="saveAsText()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        📄 텍스트로 저장
                    </button>
                    <button onclick="printResult()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        🖨️ 인쇄하기
                    </button>
                    <button onclick="resetForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors">
                        🔄 새로 시작하기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 알림 시스템 -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <!-- 도움말 버튼 -->
    <button onclick="showHelp()" class="fixed bottom-4 right-4 bg-indigo-500 hover:bg-indigo-600 text-white p-4 rounded-full shadow-lg transition-colors z-50">
        ❓
    </button>

    <script>
        // 전역 변수
        let currentStep = 1;
        let selectedCategory = null;
        let selectedWorry = null;
        let selectedEmotion = null;
        let selectedCommitments = [];

        // 카테고리별 데이터
        const categoryData = {
            '수업 참여': {
                icon: '📚',
                description: '집중도, 참여도, 발표 등',
                examples: [
                    "수업 시간에 학생들이 집중하지 않고 자꾸 떠들어요",
                    "질문을 해도 대답하는 학생이 거의 없어요", 
                    "발표를 시켜도 학생들이 소극적이에요",
                    "수업 중에 딴짓하는 학생들이 많아요"
                ],
                thinking: [
                    "제가 재미있게 느꼈던 수업은 게임이나 활동이 있었어요",
                    "질문을 받을 때 틀릴까봐 걱정되는 마음도 있어요", 
                    "친구들과 함께 하는 활동이 더 참여하고 싶게 만들어요",
                    "선생님이 웃으면서 격려해주시면 용기가 나요",
                    "작은 성공 경험이 있으면 더 적극적이 되어요",
                    "수업 내용이 우리 일상과 연결되면 더 흥미로워요"
                ],
                actions: [
                    "손들기 전에 짝과 먼저 이야기해보는 시간 주기",
                    "정답이 아니어도 칭찬해주는 분위기 만들기",
                    "조별 활동으로 부담 줄여주기",
                    "재미있는 퀴즈나 게임 활동 추가하기",
                    "발표 대신 그림이나 글로 표현할 기회 주기",
                    "소그룹 토론으로 발언 기회 늘리기"
                ]
            },
            '학급 관리': {
                icon: '👥',
                description: '규칙, 분위기, 갈등 관리',
                examples: [
                    "아이들이 자꾸 싸워서 교실 분위기가 어수선해요",
                    "학급 규칙을 지키지 않는 학생들이 있어요",
                    "친구들 간에 갈등이 자주 생겨요",
                    "교실 정리정돈이 잘 안돼요"
                ],
                thinking: [
                    "규칙이 너무 많으면 기억하기 어려워요",
                    "왜 그 규칙이 필요한지 이유를 알고 싶어요",
                    "친구들과 함께 정한 규칙은 더 잘 지키게 되어요",
                    "칭찬받을 때 규칙을 지키고 싶은 마음이 더 생겨요",
                    "벌보다는 보상이 더 동기가 되어요",
                    "학급의 일원이라는 소속감이 있으면 더 협력하게 되어요"
                ],
                actions: [
                    "학급 규칙을 함께 정하는 시간 만들기",
                    "규칙을 지킨 친구들 칭찬하기",
                    "교실 꾸미기나 정리를 함께 하기",
                    "역할 분담으로 책임감 느끼게 하기",
                    "갈등 해결하는 방법 가르쳐주기",
                    "긍정적인 학급 문화 만들기 활동하기"
                ]
            },
            '학습 지도': {
                icon: '📖',
                description: '학습 속도, 숙제, 성적 관리',
                examples: [
                    "학습 속도가 다른 학생들을 어떻게 지도할지 고민이에요",
                    "숙제를 안 해오는 학생이 많아요",
                    "시험 성적이 전반적으로 낮아요",
                    "개별 학습 지원이 어려워요"
                ],
                thinking: [
                    "어려운 문제는 단계별로 나누어 주시면 이해하기 쉬워요",
                    "친구에게 설명해볼 기회가 있으면 더 잘 기억해요",
                    "틀려도 괜찮다는 분위기에서 더 시도하게 되어요",
                    "내가 좋아하는 것과 연결해서 배우면 더 재미있어요",
                    "선생님이 개별적으로 도움주시면 더 집중하게 되어요",
                    "학습 목표를 명확히 알면 더 동기가 생겨요"
                ],
                actions: [
                    "짝 활동으로 서로 가르쳐주는 시간 만들기",
                    "수준별 과제나 선택권 주기",
                    "작은 성취도 인정하고 격려하기",
                    "학생의 관심사와 연결한 예시 사용하기",
                    "숙제 체크리스트나 계획표 함께 만들기",
                    "개별 맞춤 피드백 제공하기"
                ]
            },
            '학부모 관계': {
                icon: '👨‍👩‍👧‍👦',
                description: '소통, 협력, 방침 차이',
                examples: [
                    "학부모가 너무 간섭이 심해서 부담스러워요",
                    "학부모와 교육 방침이 달라요",
                    "상담 요청이 너무 많아서 시간이 부족해요",
                    "학부모의 과도한 기대가 부담돼요"
                ],
                thinking: [
                    "부모님이 선생님을 믿고 지지해주시면 좋겠어요",
                    "집과 학교가 다르면 우리도 혼란스러워요",
                    "선생님의 교육 방식에 대해 설명해주시면 이해하기 쉬워요",
                    "부모님과 선생님이 협력하는 모습을 보면 안심돼요",
                    "선생님이 우리를 위해 노력하신다는 걸 부모님도 알면 좋겠어요",
                    "학생 중심으로 생각해주시면 감사해요"
                ],
                actions: [
                    "교육 철학이나 방법을 편지로 설명하기",
                    "학생의 성장 과정을 사진이나 영상으로 공유하기",
                    "학부모 참여 활동 기획하기",
                    "정기적인 소통 시간 정하기",
                    "학생의 장점을 먼저 이야기하기",
                    "투명한 교육과정 공유하기"
                ]
            },
            '업무 스트레스': {
                icon: '💼',
                description: '업무량, 시간 부족, 동료 관계',
                examples: [
                    "업무가 너무 많아서 수업 준비할 시간이 부족해요",
                    "회의와 행정업무로 인해 지쳐요",
                    "동료 교사와의 관계가 어려워요",
                    "워라밸이 맞지 않아 힘들어요"
                ],
                thinking: [
                    "선생님이 힘들어하시면 우리도 걱정돼요",
                    "선생님도 쉬는 시간이 필요하다고 생각해요",
                    "선생님이 웃으시면 교실 분위기가 좋아져요",
                    "우리가 도울 수 있는 일이 있으면 말해주세요",
                    "선생님의 건강이 가장 중요해요",
                    "완벽하지 않아도 우리는 선생님을 좋아해요"
                ],
                actions: [
                    "학생들과 업무 분담하기 (청소, 정리 등)",
                    "간단한 업무는 학생 도우미 활용하기",
                    "동료 선생님과 협력 체계 만들기",
                    "완벽하지 않아도 된다는 마음가짐 갖기",
                    "휴식 시간 확보하고 자기 돌봄하기",
                    "우선순위를 정해서 업무 관리하기"
                ]
            }
        };

        // 감정 데이터
        const emotions = [
            { name: "속상함", emoji: "😢", empathy: "정말 속상하셨을 것 같아요. 그런 마음 충분히 이해해요." },
            { name: "걱정됨", emoji: "😰", empathy: "많이 걱정되시는군요. 그런 고민을 하시는 선생님의 마음이 느껴져요." },
            { name: "답답함", emoji: "😤", empathy: "정말 답답하셨을 거예요. 어떻게 해야 할지 막막하셨을 것 같아요." },
            { name: "스트레스", emoji: "😵", empathy: "스트레스가 많이 쌓이셨나봐요. 힘드셨을 텐데 이렇게 고민해주셔서 고마워요." },
            { name: "실망", emoji: "😞", empathy: "실망스러우셨을 거예요. 기대했던 것과 달라서 더 속상하셨을 것 같아요." },
            { name: "부담", emoji: "😓", empathy: "많은 부담을 느끼고 계시는군요. 그런 마음 정말 공감해요." },
            { name: "미안함", emoji: "😔", empathy: "미안한 마음이 드시는군요. 그런 마음을 가지시는 것만으로도 좋은 선생님이세요." },
            { name: "피곤함", emoji: "😴", empathy: "정말 피곤하셨을 거예요. 쉬는 시간도 부족하실 텐데 고생이 많으세요." }
        ];

        const encouragementMessages = [
            "선생님의 고민하는 마음 자체가 학생들에 대한 사랑이에요! 💖",
            "완벽한 선생님은 없어요. 지금도 충분히 멋진 선생님이세요! ⭐",
            "학생들은 선생님이 생각하는 것보다 훨씬 선생님을 좋아해요! 😊",
            "작은 변화도 큰 차이를 만들어요. 포기하지 마세요! 🌱",
            "선생님의 노력하는 모습을 학생들이 모두 보고 있어요! 👀",
            "힘들 때는 쉬어도 괜찮아요. 선생님의 건강이 우선이에요! 🍃",
            "학생들에게 물어보세요. 분명 좋은 아이디어를 줄 거예요! 💡",
            "선생님만의 특별한 방법이 있을 거예요. 자신감을 가지세요! 💪",
            "실수해도 괜찮아요. 그것도 우리에게는 좋은 배움이에요! 📚",
            "선생님이 있어서 우리 교실이 따뜻해요. 감사해요! 🏠"
        ];

        const commitmentOptions = [
            "우리가 더 적극적으로 참여하도록 노력할게요",
            "선생님이 힘들어하시면 바로 도와드릴게요",
            "친구들과 사이좋게 지내도록 더 노력할게요",
            "수업 시간에 더 집중하도록 할게요",
            "선생님께 감사한 마음을 자주 표현할게요",
            "교실 정리정돈을 더 잘 할게요",
            "다른 친구들도 배려하는 마음을 가질게요",
            "선생님의 새로운 아이디어를 응원할게요"
        ];

        // 카테고리 카드 렌더링
        function renderCategoryCards() {
            const container = document.getElementById('categoryCards');
            container.innerHTML = '';
            
            Object.entries(categoryData).forEach(([category, data]) => {
                const card = document.createElement('div');
                card.className = `category-card category-${category.replace(' ', '')}`;
                card.onclick = () => selectCategory(category);
                card.innerHTML = `
                    <div class="text-4xl mb-3">${data.icon}</div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${category}</h3>
                    <p class="text-sm text-gray-600">${data.description}</p>
                    <div class="text-xs text-blue-600 mt-2">${data.examples.length}개 예시</div>
                `;
                container.appendChild(card);
            });
        }

        // 카테고리 선택
        function selectCategory(category) {
            // 기존 선택 해제
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.category-card').classList.add('selected');
            
            selectedCategory = category;
            
            // 상황 선택 화면으로 전환
            document.getElementById('categorySelection').classList.add('hidden');
            document.getElementById('situationSelection').classList.remove('hidden');
            document.getElementById('selectedCategoryTitle').textContent = `${categoryData[category].icon} ${category} 관련 고민`;
            
            // 상황 예시 렌더링
            renderSituationExamples(category);
            
            showNotification(`📂 "${category}" 분야가 선택되었습니다!`);
        }

        // 상황 예시 렌더링
        function renderSituationExamples(category) {
            const container = document.getElementById('situationExamples');
            const data = categoryData[category];
            container.innerHTML = '';
            
            data.examples.forEach((example, index) => {
                const card = document.createElement('div');
                card.className = 'situation-example';
                card.onclick = () => selectSituationExample(example, index);
                card.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-semibold text-sm">
                            ${index + 1}
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-800 font-medium">${example}</p>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // 상황 예시 선택
        function selectSituationExample(example, index) {
            // 기존 선택 해제
            document.querySelectorAll('.situation-example').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.situation-example').classList.add('selected');
            
            selectedWorry = {
                category: selectedCategory,
                text: example,
                isExample: true,
                index: index
            };
            
            // 직접 입력 텍스트 초기화
            document.getElementById('customWorry').value = '';
            
            // 다음 버튼 활성화
            document.getElementById('step2Next').disabled = false;
            
            // 맞춤형 체크리스트 로드
            loadCustomizedChecklists(selectedCategory);
            
            showNotification('📝 고민 상황이 선택되었습니다!');
        }

        // 직접 입력 처리
        function checkCustomWorryInput() {
            const customWorry = document.getElementById('customWorry').value.trim();
            const nextBtn = document.getElementById('step2Next');
            
            if (customWorry.length > 0 && selectedCategory) {
                // 기존 상황 선택 해제
                document.querySelectorAll('.situation-example').forEach(card => {
                    card.classList.remove('selected');
                });
                
                selectedWorry = {
                    category: selectedCategory,
                    text: customWorry,
                    isCustom: true
                };
                
                nextBtn.disabled = false;
                
                // 맞춤형 체크리스트 로드
                loadCustomizedChecklists(selectedCategory);
                
            } else if (selectedWorry && selectedWorry.isExample) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
        }

        // 카테고리 선택으로 돌아가기
        function backToCategories() {
            document.getElementById('situationSelection').classList.add('hidden');
            document.getElementById('categorySelection').classList.remove('hidden');
            
            // 선택 초기화
            selectedWorry = null;
            selectedCategory = null;
            document.getElementById('customWorry').value = '';
            document.getElementById('step2Next').disabled = true;
            
            // 카테고리 선택 해제
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // 📝 맞춤형 체크리스트 로드
        function loadCustomizedChecklists(category) {
            const data = categoryData[category];
            if (!data) return;
            
            // 생각 체크리스트
            const thinkingContainer = document.getElementById('customThinkingChecklist');
            thinkingContainer.innerHTML = data.thinking.map((item, index) => `
                <div class="checklist-item" onclick="toggleChecklistItem(this, 'thinking')">
                    <input type="checkbox" id="thinking-${index}" class="thinking-checkbox">
                    <label for="thinking-${index}">${item}</label>
                </div>
            `).join('');
            
            // 행동 체크리스트
            const actionContainer = document.getElementById('customActionChecklist');
            actionContainer.innerHTML = data.actions.map((item, index) => `
                <div class="checklist-item" onclick="toggleChecklistItem(this, 'action')">
                    <input type="checkbox" id="action-${index}" class="action-checkbox">
                    <label for="action-${index}">${item}</label>
                </div>
            `).join('');
        }

        // ✅ 체크리스트 아이템 토글
        function toggleChecklistItem(itemDiv, type) {
            const checkbox = itemDiv.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                itemDiv.classList.add('selected');
            } else {
                itemDiv.classList.remove('selected');
            }
            
            updateChecklistCounts();
            updateRealtimeAdvicePreview();
        }

        // 📊 체크리스트 선택 개수 업데이트
        function updateChecklistCounts() {
            const thinkingChecked = document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked').length;
            const actionChecked = document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked').length;
            
            document.getElementById('thinkingCount').textContent = `${thinkingChecked}개 선택`;
            document.getElementById('actionCount').textContent = `${actionChecked}개 선택`;
        }

        // 🎯 선택된 고민 지속 표시 업데이트
        function updateSelectedWorryDisplay() {
            if (selectedWorry && currentStep >= 3 && currentStep < 7) {
                const worryCard = document.getElementById('selectedWorryCard');
                const worryText = document.getElementById('selectedWorryText');
                const worryCategory = document.getElementById('selectedWorryCategory');
                
                worryText.textContent = selectedWorry.text;
                worryCategory.className = `category-badge category-${selectedWorry.category.replace(' ', '')}`;
                worryCategory.textContent = `${categoryData[selectedWorry.category].icon} ${selectedWorry.category}`;
                
                worryCard.classList.remove('hidden');
            } else {
                document.getElementById('selectedWorryCard').classList.add('hidden');
            }
        }

        // 🔄 실시간 조언 미리보기 업데이트
        function updateRealtimeAdvicePreview() {
            const thinkingChecked = Array.from(document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            const actionChecked = Array.from(document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (thinkingChecked.length > 0 || actionChecked.length > 0) {
                let previewHTML = '';
                
                if (thinkingChecked.length > 0) {
                    previewHTML += '<h4 class="font-semibold mb-2 text-purple-700">💭 생각해볼 점:</h4>';
                    previewHTML += `<p class="mb-4">${thinkingChecked.join('. ')}.</p>`;
                }
                
                if (actionChecked.length > 0) {
                    previewHTML += '<h4 class="font-semibold mb-2 text-cyan-700">🎯 시도해볼 방법:</h4>';
                    previewHTML += '<ul class="list-disc list-inside">';
                    actionChecked.forEach(action => {
                        previewHTML += `<li>${action}</li>`;
                    });
                    previewHTML += '</ul>';
                }
                
                document.getElementById('advicePreviewContent').innerHTML = previewHTML;
                document.getElementById('realtimeAdvicePreview').classList.remove('hidden');
            } else {
                document.getElementById('realtimeAdvicePreview').classList.add('hidden');
            }
        }

        // 📝 생각 체크리스트 적용
        function applyThinkingChecklist() {
            const checkedItems = Array.from(document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (checkedItems.length > 0) {
                const textarea = document.getElementById('thinking-textarea');
                const currentText = textarea.value;
                const newText = checkedItems.join('. ') + '.';
                
                if (currentText.trim()) {
                    textarea.value = currentText + '\n\n' + newText;
                } else {
                    textarea.value = newText;
                }
                
                // 체크박스 초기화
                document.querySelectorAll('#customThinkingChecklist input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.checklist-item').classList.remove('selected');
                });
                
                updateChecklistCounts();
                updateRealtimeAdvicePreview();
                showNotification('💭 선택한 생각들이 적용되었습니다!');
            } else {
                showNotification('❗ 적용할 항목을 선택해주세요!');
            }
        }

        // 🎯 행동 체크리스트 적용
        function applyActionChecklist() {
            const checkedItems = Array.from(document.querySelectorAll('#customActionChecklist input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent.trim());
            
            if (checkedItems.length > 0) {
                const textarea = document.getElementById('action-textarea');
                const currentText = textarea.value;
                const newText = checkedItems.map((item, index) => `${index + 1}) ${item}`).join('\n');
                
                if (currentText.trim()) {
                    textarea.value = currentText + '\n\n' + newText;
                } else {
                    textarea.value = newText;
                }
                
                // 체크박스 초기화
                document.querySelectorAll('#customActionChecklist input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.checklist-item').classList.remove('selected');
                });
                
                updateChecklistCounts();
                updateRealtimeAdvicePreview();
                showNotification('🎯 선택한 방법들이 적용되었습니다!');
            } else {
                showNotification('❗ 적용할 항목을 선택해주세요!');
            }
        }

        // 감정 버튼 렌더링
        function renderEmotionButtons() {
            const container = document.getElementById('emotionButtons');
            container.innerHTML = '';
            
            emotions.forEach(emotion => {
                const button = document.createElement('button');
                button.className = 'emotion-btn bg-white border-2 border-gray-200 rounded-lg p-4 text-center hover:border-green-400 transition-all duration-200';
                button.onclick = () => selectEmotion(emotion);
                button.innerHTML = `
                    <div class="text-3xl mb-2">${emotion.emoji}</div>
                    <div class="font-medium">${emotion.name}</div>
                `;
                container.appendChild(button);
            });
        }

        // 감정 선택
        function selectEmotion(emotion) {
            // 기존 선택 해제
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // 새 선택 표시
            event.target.closest('.emotion-btn').classList.add('selected');
            
            selectedEmotion = emotion;
            
            // 공감 메시지 표시
            document.getElementById('empathyText').textContent = emotion.empathy;
            document.getElementById('empathyMessage').classList.remove('hidden');
            
            // 다음 버튼 활성화
            document.getElementById('step4Next').disabled = false;
            
            showNotification('💚 감정이 선택되었습니다!');
        }

        // 실천 약속 옵션 렌더링
        function renderCommitmentOptions() {
            const container = document.getElementById('commitmentOptions');
            container.innerHTML = '';
            
            commitmentOptions.forEach((option, index) => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-indigo-50';
                label.innerHTML = `
                    <input type="checkbox" value="${index}" onchange="toggleCommitment(${index})" class="rounded">
                    <span class="text-sm">${option}</span>
                `;
                container.appendChild(label);
            });
        }

        // 실천 약속 토글
        function toggleCommitment(index) {
            const checkbox = event.target;
            if (checkbox.checked) {
                selectedCommitments.push(commitmentOptions[index]);
            } else {
                selectedCommitments = selectedCommitments.filter(c => c !== commitmentOptions[index]);
            }
        }

        // 격려 메시지 뽑기
        function drawEncouragementMessage() {
            const randomIndex = Math.floor(Math.random() * encouragementMessages.length);
            const message = encouragementMessages[randomIndex];
            
            document.getElementById('encouragementText').textContent = message;
            document.getElementById('encouragementCard').classList.remove('hidden');
            
            showNotification('💌 따뜻한 격려 메시지가 도착했어요!');
        }

        // 알림 표시 함수
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 단계 이동 함수
        function goToStep(targetStep) {
            // 현재 단계 숨기기
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            // 타겟 단계 보이기
            document.getElementById(`step${targetStep}`).classList.remove('hidden');
            document.getElementById(`step${targetStep}`).classList.add('active');
            document.getElementById(`step${targetStep}`).scrollIntoView({ behavior: 'smooth' });
            
            // 7단계일 때 네비게이션과 헤더 숨기기
            const stepNav = document.getElementById('stepNavigation');
            const headerDiv = document.querySelector('.text-center.mb-8');
            
            if (targetStep === 7) {
                stepNav.classList.add('hidden-final');
                headerDiv.classList.add('hidden');
                document.body.className = 'final-result-container';
            } else {
                stepNav.classList.remove('hidden-final');
                headerDiv.classList.remove('hidden');
                document.body.className = 'bg-gray-50 min-h-screen';
            }
            
            // 단계 버튼 업데이트 (7단계가 아닐 때만)
            if (targetStep !== 7) {
                document.querySelectorAll('.step-btn').forEach((btn, index) => {
                    const btnStep = index + 1;
                    btn.classList.remove('active');
                    
                    if (btnStep === targetStep) {
                        btn.classList.add('active');
                    }
                    
                    if (btnStep < targetStep) {
                        btn.classList.remove('disabled');
                        btn.classList.add('completed');
                    } else if (btnStep > targetStep) {
                        btn.classList.add('disabled');
                        btn.classList.remove('completed');
                    }
                });
            }
            
            currentStep = targetStep;
            
            // 선택된 고민 지속 표시 업데이트
            updateSelectedWorryDisplay();
            
            // 5단계에서 맞춤형 조언 안내 업데이트
            if (targetStep === 5 && selectedWorry) {
                updateAdviceIntro();
            }
            
            if (targetStep !== 7) {
                showNotification(`📍 ${targetStep}단계로 이동했습니다!`);
            }
        }

        // 5단계 맞춤형 조언 안내 업데이트
        function updateAdviceIntro() {
            if (selectedWorry) {
                const introText = document.getElementById('adviceIntroText');
                introText.textContent = `"${selectedWorry.category}" 분야의 고민에 특화된 조언들을 준비했습니다! 가장 도움이 될 것 같은 항목들을 선택해주세요.`;
            }
        }

        // 다음 단계로 이동
        function nextStep(step) {
            // 유효성 검사
            if (step === 1) {
                const studentName = document.getElementById('studentName').value.trim();
                const teacherName = document.getElementById('teacherName').value.trim();
                if (!studentName || !teacherName) {
                    showNotification('❗ 학생 이름과 선생님 이름을 모두 입력해주세요.');
                    return;
                }
            }
            
            if (step === 2) {
                if (!selectedWorry) {
                    showNotification('❗ 고민 분야를 선택하고 구체적인 상황을 선택해주세요.');
                    return;
                }
                
                // ABC 필드 초기 설정
                document.getElementById('factA').value = selectedWorry.text;
                document.getElementById('beliefB').value = '';
                document.getElementById('consequenceC').value = '';
            }
            
            if (step === 6) {
                generateFinalResult();
                goToStep(7);
                return;
            }
            
            goToStep(step + 1);
        }

        // 이전 단계로 이동
        function prevStep(step) {
            goToStep(step - 1);
        }

        // 최종 결과 생성
        function generateFinalResult() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const personalMessage = document.getElementById('personalMessage').value;
            
            let resultHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">🌟 ${studentName}의 맞춤형 상담 결과</h3>
                    <p class="text-lg text-gray-600">${teacherName}을 위한 카테고리 기반 조언</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">📂 선택된 고민 분야</h4>
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <span class="category-badge category-${selectedWorry.category.replace(' ', '')}">${categoryData[selectedWorry.category].icon} ${selectedWorry.category}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <h4 class="font-semibold text-gray-800 mb-2">💖 선택한 감정</h4>
                        <p class="text-gray-600">${selectedEmotion?.emoji} ${selectedEmotion?.name}</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">📝 고민 상황</h4>
                    <p class="text-gray-600">${selectedWorry?.text}</p>
                </div>
                
                <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">🎯 맞춤형 조언</h4>
                    ${document.getElementById('advicePreviewContent').innerHTML || '<p class="text-gray-500">작성된 조언이 없습니다.</p>'}
                </div>
            `;
            
            if (document.getElementById('encouragementText').textContent) {
                resultHTML += `
                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200 mt-4">
                        <h4 class="font-semibold text-yellow-800 mb-2">💌 격려 메시지</h4>
                        <p class="text-gray-700">${document.getElementById('encouragementText').textContent}</p>
                    </div>
                `;
            }
            
            if (personalMessage) {
                resultHTML += `
                    <div class="bg-pink-50 rounded-lg p-4 border border-pink-200 mt-4">
                        <h4 class="font-semibold text-pink-800 mb-2">✏️ 개인 메시지</h4>
                        <p class="text-gray-700">${personalMessage}</p>
                    </div>
                `;
            }
            
            if (selectedCommitments.length > 0) {
                resultHTML += `
                    <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-200 mt-4">
                        <h4 class="font-semibold text-indigo-800 mb-2">🤝 우리의 약속</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            ${selectedCommitments.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            document.getElementById('finalResult').innerHTML = resultHTML;
        }

        // 텍스트로 저장
        function saveAsText() {
            const studentName = document.getElementById('studentName').value;
            const teacherName = document.getElementById('teacherName').value;
            const date = new Date().toLocaleDateString('ko-KR');
            
            let content = `ABC 카테고리 기반 상담 결과\n`;
            content += `상담일: ${date}\n`;
            content += `상담 학생: ${studentName}\n`;
            content += `상담 대상: ${teacherName}\n\n`;
            
            content += `[고민 분야]\n${selectedWorry.category}\n\n`;
            content += `[고민 상황]\n${selectedWorry?.text}\n\n`;
            
            content += `[ABC 분석]\n`;
            content += `A (사실): ${document.getElementById('factA').value}\n`;
            content += `B (생각): ${document.getElementById('beliefB').value}\n`;
            content += `C (결과): ${document.getElementById('consequenceC').value}\n\n`;
            
            content += `[감정]: ${selectedEmotion?.name}\n\n`;
            
            // 조언 내용 추가
            const thinkingText = document.getElementById('thinking-textarea')?.value;
            const actionText = document.getElementById('action-textarea')?.value;
            
            if (thinkingText || actionText) {
                content += `[맞춤형 조언]\n`;
                if (thinkingText) {
                    content += `생각해볼 점:\n${thinkingText}\n\n`;
                }
                if (actionText) {
                    content += `시도해볼 방법:\n${actionText}\n\n`;
                }
            }
            
            const encouragement = document.getElementById('encouragementText').textContent;
            if (encouragement) {
                content += `[격려 메시지]\n${encouragement}\n\n`;
            }
            
            const personalMessage = document.getElementById('personalMessage').value;
            if (personalMessage) {
                content += `[개인 메시지]\n${personalMessage}\n\n`;
            }
            
            if (selectedCommitments.length > 0) {
                content += `[우리의 약속]\n`;
                selectedCommitments.forEach(c => content += `- ${c}\n`);
            }
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ABC카테고리상담_${studentName}_${date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('📄 파일이 다운로드되었습니다!');
        }

        // 인쇄
        function printResult() {
            window.print();
        }

        // 폼 리셋
        function resetForm() {
            if (confirm('정말 새로 시작하시겠습니까? 모든 내용이 삭제됩니다.')) {
                location.reload();
            }
        }

        // 도움말
        function showHelp() {
            alert(`ABC 교사 상담 도구 사용법:\n\n🎨 카테고리 우선 선택:\n• 먼저 고민 분야를 선택합니다\n• 해당 분야의 예시 상황을 확인합니다\n• 예시 선택 또는 직접 입력합니다\n\n1. 학생과 선생님 이름을 입력합니다\n2. 고민 분야를 선택하고 구체적 상황을 정합니다\n3. ABC 모델로 상황을 분석합니다\n4. 선생님의 감정에 공감합니다\n5. 맞춤형 체크리스트로 조언을 제공합니다\n6. 격려 메시지와 실천 약속을 정합니다\n7. 결과를 저장하거나 인쇄할 수 있습니다\n\n✨ 모든 기능을 활용해보세요!`);
        }

        // 초기화
        function init() {
            renderCategoryCards();
            renderEmotionButtons();
            renderCommitmentOptions();
            
            // 단계 네비게이션 이벤트 리스너
            document.querySelectorAll('.step-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const step = parseInt(this.dataset.step);
                    if (!this.classList.contains('disabled')) {
                        goToStep(step);
                    }
                });
            });
        }

        // 페이지 로드 시 초기화
        window.onload = init;
    </script>
</body>
</html>